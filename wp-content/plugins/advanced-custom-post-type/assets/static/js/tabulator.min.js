var $=jQuery.noConflict();jQuery(function(){document.addEventListener("fetchLanguages",e=>{function t(){$(".acpt-tabulator").each(function(){let l=[];var e=$(this);let m=e.attr("id");var t=e.data("target-id");let a=$(`input[name='${m}']`),c=(0===a.length&&(a=$(`input[name='${t}']`)),$("#acpt-create-table-"+m)),r=e.next(".btn-wrapper"),o=r.next(".outcome"),n=r.find(".acpt-open-table-settings"),s=r.find(".acpt-open-import-template"),p=`<a class="acpt-open-save-template button button-secondary" href="#acpt-save-template-${m}" rel="modal:open" >${useTranslation("Save as template")}</a>`;if(m){let u=new ACPTTabulator(m);t=a.val();if("string"==typeof t&&""!==t&&"{}"!==t)try{var d=JSON.parse(t);u.createTable(d)}catch(e){console.error(e)}function i(){$(".jquery-modal.blocker.current").remove()}function b(e,t="success"){let a="danger"===t?"#b02828":"#02c39a";o.css("color",a),o.css("marginTop","10px"),o.text(useTranslation(e)),setTimeout(function(){o.css("color","#777"),o.css("marginTop","0"),o.text("")},5e3)}document.addEventListener("acpt-tabulator-change",function(e){var t=e.detail.json,e=e.detail.id;t.data&&0<t.data.length?(c.find("h3").text(useTranslation("Edit table settings")),c.find(".acpt-create-table").text(useTranslation("Edit")),$("#acpt-create-table-layout-"+m).val(t.settings.layout),$("#acpt-create-table-alignment-"+m).val(t.settings.alignment),$("#acpt-create-table-border-thickness-"+m).val(t.settings.border.thickness),$("#acpt-create-table-border-style-"+m).val(t.settings.border.style),$("#acpt-create-table-border-color-"+m).val(t.settings.border.color),$("#acpt-create-table-background-color-"+m).val(t.settings.background.color),$("#acpt-create-table-zebra-background-"+m).val(t.settings.background.zebra),$("#acpt-create-table-color-"+m).val(t.settings.color),$("#acpt-create-table-css-"+m).val(t.settings.css),$("#acpt-create-table-header-"+m).prop("checked",t.settings.header),$("#acpt-create-table-footer-"+m).prop("checked",t.settings.footer),$("#acpt-create-table-columns-"+m).val(t.settings.columns),$("#acpt-create-table-rows-"+m).val(t.settings.rows),n.text("Edit table settings"),0===r.find(".acpt-open-save-template").length&&$(p).insertAfter(s)):(c.find("h3").text(useTranslation("Create table")),c.find(".acpt-create-table").text(useTranslation("Create")),$("#acpt-create-table-layout-"+m).val("horizontal"),$("#acpt-create-table-alignment-"+m).val("left"),$("#acpt-create-table-border-thickness-"+m).val(1),$("#acpt-create-table-border-style-"+m).val("solid"),$("#acpt-create-table-border-color-"+m).val("#cccccc"),$("#acpt-create-table-background-color-"+m).val("#ffffff"),$("#acpt-create-table-zebra-background-"+m).val("#ffffff"),$("#acpt-create-table-color-"+m).val("#777777"),$("#acpt-create-table-css-"+m).val(""),$("#acpt-create-table-header-"+m).prop("checked",!0),$("#acpt-create-table-header-"+m).show(),$(`label[for="acpt-create-table-header-${m}"]`).show(),$("#acpt-create-table-footer-"+m).prop("checked",!1),$("#acpt-create-table-columns-"+m).val(2),$("#acpt-create-table-rows-"+m).val(2),n.text(useTranslation("Create table")),r.find(".acpt-open-save-template").remove()),e===m&&a.val(JSON.stringify(t))}),$("body").on("click",".acpt-open-import-template",function(e){wpAjaxRequest("fetchTableTemplatesAction",{}).then(e=>e.json()).then(e=>{l=e;let t=$("#acpt-import-template-name-"+m);t.find("li").remove().end(),0<e.length?e.map(e=>{t.append($(`
                                    <li>
                                        <p class="label" title="${(e=e).name}">
                                            ${e.name}
                                        </p>
                                        <span class="buttons">
                                            <a class="button button-secondary acpt-apply-template" data-target-id="${e.id}" title="${useTranslation("Apply")}" rel="modal:close" href="#">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" viewBox="0 0 24 24"><path fill="#007cba" d="M11 15h2V9h3l-4-5l-4 5h3z"/><path fill="#007cba" d="M20 18H4v-7H2v7c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2v-7h-2z"/></svg>
                                            </a>
                                            <a class="button button-danger acpt-delete-template" data-target-id="${e.id}" title="${useTranslation("Delete")}" rel="modal:close" href="#">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" viewBox="0 0 24 24"><path fill="#b02828" d="M5 20a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8h2V6h-4V4a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v2H3v2h2zM9 4h6v2H9zM8 8h9v12H7V8z"/><path fill="#b02828" d="M9 10h2v8H9zm4 0h2v8h-2z"/></svg>
                                            </a>
                                        </span>
                                    </li>
                                `))}):t.append($(`<li>${useTranslation("No templates found.")}</li>`))})}),$("body").on("click",".acpt-apply-template",function(e){let t=$(this).data("target-id");var a=l.filter(e=>Number(e.id)===Number(t));1===a.length?(a=a[0],u.createTable(a.json),i(),b("The template was successfully imported!")):($("#acpt-import-template-"+m).find(".errors").css("marginBottom","10px"),$("#acpt-import-template-"+m).find(".errors").text("There was an error during the import of the template"))}),$("body").on("click",".acpt-delete-template",function(e){var t=$(this).data("target-id");wpAjaxRequest("deleteTableTemplateAction",{id:t}).then(e=>e.json()).then(e=>{e.success?(i(),b("The template was successfully deleted!")):e.error&&(i(),b(e.error,"danger"))})}),$("body").on("keyup","#acpt-save-template-name-"+m,function(e){""!==e.target.value?$("#acpt-save-template-"+m).find(".acpt-save-template-name").removeClass("disabled"):$("#acpt-save-template-"+m).find(".acpt-save-template-name").addClass("disabled")}),$("body").on("click",".acpt-save-template-name",function(e){e.preventDefault(),wpAjaxRequest("saveTableTemplate",{name:$("#acpt-save-template-name-"+m).val(),json:u.json}).then(e=>e.json()).then(e=>{!0===e.success?($("#acpt-save-template-name-"+m).val(""),$("#acpt-save-template-"+m).find(".acpt-save-template-name").addClass("disabled"),i(),b("The template was successfully saved!")):($("#acpt-save-template-"+m).find(".errors").css("marginBottom","10px"),$("#acpt-save-template-"+m).find(".errors").text(e.error),console.error(e.error))})}),$("body").on("click","#acpt-create-table-layout-"+m,function(e){"horizontal"===e.target.value?($("#acpt-create-table-header-"+m).prop("checked",!0),$("#acpt-create-table-header-"+m).show(),$(`label[for="acpt-create-table-header-${m}"]`).show()):"vertical"===e.target.value&&($("#acpt-create-table-header-"+m).prop("checked",!1),$("#acpt-create-table-header-"+m).hide(),$(`label[for="acpt-create-table-header-${m}"]`).hide())}),$("body").on("click",`.acpt-clear-table[data-target-id=${m}]`,function(e){e.preventDefault(),u.destroyTable()}),$("body").on("click",`.acpt-create-table[data-target-id=${m}]`,function(e){e.preventDefault();var e=$("#acpt-create-table-layout-"+m).val(),t=$("#acpt-create-table-alignment-"+m).val(),a=$("#acpt-create-table-border-thickness-"+m).val(),l=$("#acpt-create-table-border-style-"+m).val(),c=$("#acpt-create-table-border-color-"+m).val(),r=$("#acpt-create-table-background-color-"+m).val(),o=$("#acpt-create-table-zebra-background-"+m).val(),n=$("#acpt-create-table-color-"+m).val(),s=$("#acpt-create-table-css-"+m).val();let p=$("#acpt-create-table-header-"+m).is(":checked"),d=$("#acpt-create-table-footer-"+m).is(":checked"),i=$("#acpt-create-table-columns-"+m).val(),b=$("#acpt-create-table-rows-"+m).val();e={settings:{layout:e,css:s,alignment:t,border:{thickness:a,style:l,color:c},background:{color:r,zebra:o},color:n,header:p,footer:d,columns:i,rows:b},data:(()=>{let a=u.defaultCellValue,t=0;var l=[],c=(e,t)=>u.json.data&&0<u.json.data.length&&u.json.data[e]&&u.json.data[e][t]?u.json.data[e][t]:{value:a,settings:{}};if(p){for(let e=0;e<Number(i);e++)l[t]||(l[t]=[]),l[t].push(c(t,e));t++}for(let e=0;e<Number(b);e++){for(let e=0;e<Number(i);e++)l[t]||(l[t]=[]),l[t].push(c(t,e));t++}if(d){for(let e=0;e<Number(i);e++)l[t]||(l[t]=[]),l[t].push(c(t,e));t++}return l})()};u.createTable(e)}),$("body").on("click",".acpt-editable-table .add-row",function(e){e.preventDefault();e=$(this).data("row-id");"number"==typeof e&&u.addRow(e)}),$("body").on("click",".acpt-editable-table .delete-row",function(e){e.preventDefault();e=$(this).data("row-id");"number"==typeof e&&u.deleteRow(e)}),$("body").on("click",".acpt-editable-table .add-col",function(e){e.preventDefault();e=$(this).data("col-id");"number"==typeof e&&u.addColumn(e)}),$("body").on("click",".acpt-editable-table .delete-col",function(e){e.preventDefault();e=$(this).data("col-id");"number"==typeof e&&u.deleteColumn(e)})}})}t(),document.addEventListener("acpt_grouped_element_added",e=>{t()}),document.addEventListener("acpt_flexible_element_added",e=>{t()})})});