class ACPTConditionalRules{constructor(e,t,a,i){this.#init(),this.action=t,this.page=e,this.belongsTo=a,this.elementId=i,this.#hideBoxesIfNotVisible()}#init(){this.formElements=document.body.querySelectorAll(".acpt-form-element"),this.metaBoxes=document.body.querySelectorAll(".acpt-metabox"),this.elements=document.body.querySelectorAll("[data-conditional-rules-id]"),this.values=[],this.checks=[],this.elements.forEach(e=>{var t=this.#getValue(e),a=e.name,i=e.getAttribute("data-conditional-rules-id"),d=e.getAttribute("data-conditional-rules-field-forged-by"),l=e.getAttribute("data-conditional-rules-field-index"),s=e.getAttribute("data-conditional-rules-block-index"),o=e.getAttribute("data-conditional-rules-block-name");"checkbox"===e.type&&a.includes("[]")?e.checked&&this.values.push({id:a.replace("[]",""),formId:i,value:t,forgedBy:d,fieldIndex:l,blockIndex:s,blockName:o}):this.values.push({id:a,formId:i,value:t,forgedBy:d,fieldIndex:l,blockIndex:s,blockName:o})})}#saveChecksInCache(e){let t=!1;switch(this.action){case"save-option-page":t="save-option-page"===e.target.id;break;case"add-tax":case"save-user":t="submit"===e.target.id;break;case"edit-tax":t=e.target.classList.contains("button-primary");break;case"save-cpt":t=e.target.classList.contains("editor-post-publish-button")||"publish"===e.target.id}t&&this.#saveInCache(this.checks)}#changeValueHandler(e){e=e.target;let t=e.name,a=e.getAttribute("data-conditional-rules-id");var i=e.getAttribute("data-conditional-rules-field-forged-by"),d=e.getAttribute("data-conditional-rules-field-index"),l=e.getAttribute("data-conditional-rules-block-index"),s=e.getAttribute("data-conditional-rules-block-name");let o=this.#getValue(e);var n=this.values.findIndex(e=>e.id===t&&e.formId===a);if("radio"===e.type)e.checked&&(this.values[n]={id:t,formId:a,value:o,forgedBy:i,fieldIndex:d,blockIndex:l,blockName:s});else if("checkbox"===e.type&&t.includes("[]"))if(e.checked)this.values.push({id:t.replace("[]",""),formId:a,value:o,forgedBy:i,fieldIndex:d,blockIndex:l,blockName:s});else{let t=[];this.values.map(e=>{(e.formId!==a||o!==e.value)&&t.push(e)}),this.values=t}else this.values[n]={id:t,formId:a,value:o,forgedBy:i,fieldIndex:d,blockIndex:l,blockName:s};this.#applyIsVisible()}run(){["acpt_flexible_element_added","acpt_grouped_element_added","acpt_grouped_element_removed","acpt_media_added"].map(e=>{document.addEventListener(e,e=>{this.#init(),this.#listenForChangeEvents()})}),this.#listenForChangeEvents(),document.addEventListener("click",e=>this.#saveChecksInCache(e))}#listenForChangeEvents(){this.elements.forEach(e=>{e.addEventListener("change",e=>this.#debounce(this.#changeValueHandler(e),1e3)),e.addEventListener("keyup",e=>this.#debounce(this.#changeValueHandler(e),1e3))})}#hideBoxesIfNotVisible(){this.metaBoxes.forEach(e=>{let a=0;var t;e.querySelectorAll(".acpt-admin-meta-row").forEach(e=>{let t=0;e.querySelectorAll(".acpt-admin-meta-wrapper").forEach(e=>{e.classList.contains("hidden")||(a++,t++)}),0===t?e.classList.add("hidden"):e.classList.remove("hidden")}),0===a&&((t=e.getAttribute("data-box-label"))&&(t=e.closest(".compat-field-"+t))&&t.remove(),(t=document.getElementById("acpt-option-page-buttons"))&&t.remove(),e.remove())})}async#applyIsVisible(){var e="string"==typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",t=new FormData;t.append("action","checkIsVisibleAction"),t.append("data",JSON.stringify({values:this.values,elementId:this.elementId,belongsTo:this.belongsTo})),fetch(e,{method:"POST",body:t}).then(e=>e.json()).then(e=>(this.#applyConditions(e),this.checks=e))}#debounce=(t,a,i=0)=>e=>{clearTimeout(i),i=setTimeout(()=>t(e),a)};#getValue=e=>"checkbox"===e.type&&"1"===e.value?e.checked?1:0:e.value;#applyConditions=t=>{for(let[e,d]of Object.entries(t))switch(typeof d){case"boolean":var a=()=>document.getElementById(e)?document.getElementById(e):document.querySelector(`[data-field-id="${e}"]`)?document.querySelector(`[data-field-id="${e}"]`):null;a()&&(!1===d?a().classList.add("hidden"):a().classList.remove("hidden"));break;case"object":a=()=>document.querySelectorAll(`[data-id="${e}"]`)&&0<document.querySelectorAll(`[data-id="${e}"]`).length?document.querySelectorAll(`[data-id="${e}"]`):document.querySelectorAll(`[data-field-id="${e}"]`)&&0<document.querySelectorAll(`[data-field-id="${e}"]`).length?document.querySelectorAll(`[data-field-id="${e}"]`):[];0<a().length&&a().forEach((e,t)=>{var a,i;void 0!==d[t]?!1===d[t]?e.classList.add("hidden"):e.classList.remove("hidden"):(t=e.querySelector(".acpt-admin-meta-field-input"))&&(a=t.getAttribute("data-conditional-rules-field-index"),i=t.getAttribute("data-conditional-rules-block-index"),t=t.getAttribute("data-conditional-rules-block-name"),void 0!==d[t][i][a])&&(!1===d[t][i][a]?e.classList.add("hidden"):e.classList.remove("hidden"))})}this.#hideBoxesIfNotVisible()};#cacheKey=()=>"acpt_conditional_rules_cache_"+this.page;#flushCache=()=>{localStorage.removeItem(this.#cacheKey())};#saveInCache=e=>{localStorage.setItem(this.#cacheKey(),JSON.stringify(e))};#fromCache=()=>{var e=localStorage.getItem(this.#cacheKey());return e?JSON.parse(e):null}}