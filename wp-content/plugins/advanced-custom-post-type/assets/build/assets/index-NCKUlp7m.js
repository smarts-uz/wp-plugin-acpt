import{j as e,u as t}from"./fields-Uuj9pZLj.js";import{a as k,R as F,u as X}from"./vendor-D21mNUGX.js";import{P as E,u as I,B as v,s as b,$,I as L,a as w,J as Z,a0 as Y,a1 as ee,a2 as q,a3 as te,D as G,a4 as U,a5 as se,a6 as B,a7 as H,m as le,c as ae,L as ne,a8 as ie,a9 as oe}from"./index-DW87FRXD.js";import{u as R,c as V,b as M,a as re,F as ce}from"./index.esm-DCQn2FO4.js";import{n as N,a as de,L as ue}from"./Layout-CbPpDR-w.js";import{S as me}from"./index-DuvxZwho.js";import{u as he,C as pe,a as xe}from"./sortable.esm-C-GypyhB.js";import{I as fe}from"./InputHidden-Sd_YdD40.js";import{I as P}from"./Input-Dag95jow.js";import{T as O}from"./index-D3iHHJgH.js";import{M as _}from"./index-mrXLwnSf.js";import{u as je}from"./index-DRV1MUeg.js";import{g as ve}from"./files-DkSZUltV.js";import"./index-Cwt3Qm9G.js";const W=({id:s,index:c})=>{const n=I(),[i,d]=k.useState(!1),{control:a}=R(),{remove:o}=V({control:a,name:"items"}),f=[e.jsx(v,{style:b.SUCCESS,onClick:m=>{m.preventDefault(),n($({id:s})),o(c),d(!i)},children:t("Yes")}),e.jsx(v,{style:b.DANGER,onClick:m=>{m.preventDefault(),d(!i)},children:t("No")})];return e.jsxs("span",{children:[e.jsx(_,{title:t("Confirm deleting option"),visible:i,buttons:f,children:t("Are you sure?")}),e.jsx("a",{href:"#",onClick:m=>{m.preventDefault(),d(!i)},children:e.jsx(O,{icon:!1,tip:t("Delete"),label:e.jsx(L,{icon:"bx-trash",width:18,color:"#F94144"})})})]})};W.propTypes={id:E.string.isRequired,index:E.number.isRequired};const z=({item:s,index:c})=>{const n=I(),{selectedElements:i}=w(u=>u.datasetState),d=()=>i.filter(Q=>Q.id===s.id).length>0,a=u=>`items.${c}.${u}`,{register:o,formState:{errors:f},control:m,setValue:D,resetField:h}=R(),p=M({control:m,name:a("value")}),g=M({control:m,name:a("label")}),{attributes:j,listeners:r,setNodeRef:l,transform:x}=he({id:s.id}),y={transform:pe.Translate.toString(x)},S=()=>s.label==="label"&&s.value==="value"?!0:s.label===s.value,[C,T]=k.useState(S()),A=()=>p||(s.value?s.value:null),K=()=>g||(s.label?s.label:null);return e.jsxs(F.Fragment,{children:[e.jsx(fe,{id:a("id"),value:s.id,register:o}),e.jsxs("tr",{id:s.id,style:y,ref:l,children:[e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...j,...r,children:e.jsx(L,{icon:"bx:dots-vertical-rounded",color:Z(),width:18})}),e.jsx(O,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${s.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${s.id}`,type:"checkbox",checked:d(),onChange:u=>{n(Y({element:s,selected:u.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:t(d()?"Deselect this element":"Select this element")})]})}),e.jsx("td",{children:e.jsx(P,{id:a("label"),register:o,errors:f,defaultValue:K(),onChangeCapture:u=>{C&&D(a("value"),u.target.value)},onClick:u=>{s.label&&u.target.value==="label"&&h(a("label"))},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsx(P,{id:a("value"),register:o,errors:f,defaultValue:A(),onChangeCapture:u=>{C&&D(a("label"),u.target.value)},onClick:u=>{s.value&&u.target.value==="value"&&h(a("value"))},validate:{required:t("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsx(O,{label:e.jsx("button",{type:"button",className:`acpt-btn-switch ${C?"active":""}`,onClick:u=>{u.preventDefault(),T(!C)},children:e.jsx(L,{icon:"bx:bx-link",width:"18px"})}),tip:t(C?"Label and value are linked":"Label and value are unlinked"),icon:!1})}),e.jsx("td",{children:e.jsx("div",{className:"i-flex-center s-8",children:e.jsx(W,{id:s.id,index:c})})})]})]})};z.propTypes={item:E.object.isRequired,index:E.number.isRequired};const be=()=>{const s=I(),[c,n]=k.useState(!1),{unregister:i}=R(),d=[e.jsx(v,{style:b.SUCCESS,onClick:a=>{a.preventDefault(),s(ee()),i("items"),n(!c)},children:t("Yes")}),e.jsx(v,{style:b.DANGER,onClick:a=>{a.preventDefault(),n(!c)},children:t("No")})];return e.jsxs(F.Fragment,{children:[e.jsx(_,{title:t("Confirm deleting all"),visible:c,buttons:d,children:t("Are you sure?")}),e.jsx(v,{type:"button",style:b.DANGER,onClick:a=>{a.preventDefault(),n(!c)},children:t("Delete all")})]})},ge=()=>{const s=I(),{items:c,selectedElements:n}=w(r=>r.datasetState),{control:i,setValue:d,getValues:a}=R(),o=M({control:i,name:"items"}),{append:f,remove:m}=V({control:i,name:"items"}),D=k.useRef(null),[h,p]=k.useState(null),g=()=>{n.map(r=>{switch(h){case"duplicate":const l=G(),x={id:l,label:r.label,value:r.value,isDefault:!1,sort:o.length+1};s(U(x)),f({id:l,label:r.label,value:r.value});break;case"delete":const y=a("items").filter(S=>S.id!==r.id);d("items",y),s($({id:r.id}));break}}),s(q())},j=()=>(n==null?void 0:n.length)===(c==null?void 0:c.length);if((n==null?void 0:n.length)>0)return e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("span",{children:[n==null?void 0:n.length," ",t("Selected items")]}),e.jsx("span",{children:e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),r.stopPropagation(),j()?s(q()):s(te())},children:t(j()?"deselect all":"select all")})})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:D,className:"form-control sm",onChange:r=>{p(r.target.value!==""?r.target.value:null)},children:[e.jsx("option",{value:"",children:t("Select")}),e.jsx("option",{value:"duplicate",children:t("Duplicate")}),e.jsx("option",{value:"delete",children:t("Delete")})]}),e.jsx(v,{style:b.WHITE,size:"sm",disabled:h===null,onClick:r=>{r.preventDefault(),g()},children:t("Execute")})]})]})},J=({id:s})=>{const c=I(),n=async i=>{const d=["json","csv","yaml"],a=i.target.files[0],o=ve(a.name),f=a.type;if(!d.includes(o))return;let m=await a.text();const D=new File([m],a.name,{type:f});let h=new FormData;h.append("id",s),h.append("file",D),c(se(h)).then(p=>{const g=p.payload;g&&g.success===!0?(N.success(t("File was successfully imported")),c(B(s)).then(j=>{j.payload&&c(H(j.payload.items))}).catch(j=>{console.error(j)})):p.error&&N.error(e.jsx("span",{dangerouslySetInnerHTML:{__html:t("Error during import occurred")}}))}).catch(p=>{console.error(p),N(p)})};return e.jsxs(F.Fragment,{children:[e.jsx("input",{onChange:i=>n(i),style:{display:"none"},accept:"application/json, application/yaml,.csv,.yaml",name:"file",type:"file",id:"upload"}),e.jsx("label",{htmlFor:"upload",className:"acpt-btn acpt-btn acpt-btn-bordered",children:t("Import data")})]})};J.propTypes={id:E.string.isRequired};const Me=()=>{const s=document.globals;s.settings;const c=s.globals,{id:n}=X(),i=I(),{data:d,loading:a}=w(l=>l.fetchDataset),{items:o}=w(l=>l.datasetState),[f]=je();k.useEffect(()=>{de(),le(t("Manage dataset")),ae("#/tools"),i(B(n)).then(l=>{l.payload&&i(H(l.payload.items))}).catch(l=>{console.error(l)})},[n]);const m=re({mode:"all"}),{move:D}=V({control:m.control,name:"items"}),h=()=>{const l={id:G(),label:"label",value:"value",isDefault:!1,sort:o.length+1};i(U(l))},p=l=>{const{active:x,over:y}=l;if(x.id===y.id)return;const S=o.findIndex(A=>A.id===x.id),C=o.findIndex(A=>A.id===y.id),T=xe(o,S,C);D(S,C),i(ie(T))},g=l=>{o&&o.map(x=>{i(Y({element:x,selected:l}))})},j=l=>{i(oe({id:d.id,name:d.name,label:d.label,items:l.items?l.items:[],emptyItems:!0})).then(x=>{const y=x.payload;y.success?N.success(t("Dataset successfully saved")):N.error(y.error)})},r=[e.jsx(J,{id:n}),e.jsx(v,{style:b.SECONDARY,type:"button",onClick:()=>{h()},children:t("Add element")}),e.jsx(v,{testId:"save-form",style:b.PRIMARY,type:"submit",children:t("Save")}),e.jsx(be,{})];return a?e.jsx(ne,{}):e.jsx(ce,{...m,children:e.jsx("form",{onSubmit:m.handleSubmit(j),children:e.jsx(ue,{actions:r,title:t("Manage dataset"),crumbs:[{label:t("ACPT Tools"),link:"/tools"},{label:t("Dataset"),link:"/tools/dataset"},{label:t("Manage dataset")}],children:o&&(o==null?void 0:o.length)>0?e.jsxs("div",{className:"flex-column s-24",ref:f,children:[e.jsx(ge,{}),e.jsx("div",{className:"bg-white b-rounded with-shadow",children:e.jsxs("div",{className:"responsive",children:[e.jsxs("table",{className:`acpt-table ${c.is_rtl?"rtl":""}`,children:[e.jsxs("thead",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-all",style:{marginLeft:"26px"},children:[e.jsx("input",{id:"select-all",type:"checkbox",onChange:l=>{g(l.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{children:t("Label")}),e.jsx("th",{children:t("Value")}),e.jsx("th",{style:{width:"10px"}}),e.jsx("th",{style:{width:"10px"}})]}),e.jsx("tbody",{ref:f,children:e.jsx(me,{onDragEnd:p,items:o,children:e.jsx(F.Fragment,{children:o.map((l,x)=>e.jsx(z,{index:x,item:l},l.id))})})})]}),e.jsx("div",{className:"p-24",children:e.jsx(v,{style:b.SECONDARY,type:"button",onClick:()=>{h()},children:t("Add element")})})]})})]}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:t('No elements saved, generate the first one clicking on "Add element" button')}),e.jsx("div",{children:e.jsx(v,{style:b.SECONDARY,type:"button",onClick:()=>{h()},children:t("Add element")})})]})})})})})};export{Me as default};
