import{j as e,u as s}from"./fields-Uuj9pZLj.js";import{a as m,R as N,L as E,u as I}from"./vendor-D21mNUGX.js";import{s as k,n as f,D as G,a as R,f as U,L as V}from"./Layout-CbPpDR-w.js";import{P as b,u as T,B as S,s as g,ag as H,r as C,w as F,I as W,p as z,a as J,b as w,m as K,c as Q,ae as X,L as Z,q as D,t as ee}from"./index-DW87FRXD.js";import{S as y}from"./SaveFormModal-Rs9bFbHG.js";import{P as se}from"./index-DfOJf81u.js";import{C as te}from"./index-BY9jGxdk.js";import{M as L}from"./index-mrXLwnSf.js";import{C as re}from"./index-DbbBejw-.js";import{u as oe,a as ne,b as le,F as ae}from"./index.esm-DCQn2FO4.js";import{r as ie}from"./forms-AWTgcgiu.js";import{B as ce}from"./index-C2f65238.js";import"./InputHidden-Sd_YdD40.js";import"./Label-DH8FgXCw.js";import"./Input-Dag95jow.js";import"./bundle.esm.min-B-HQpnrw.js";import"./validation-dtG0NF0D.js";import"./Select-Cp1uHe-V.js";import"./index-kc5wfrYu.js";import"./metaTypes-Bb9tjSPe.js";import"./index-D3iHHJgH.js";import"./index-Cwt3Qm9G.js";import"./index-Bskps18W.js";import"./posts-DQvmjIOC.js";import"./index-DRV1MUeg.js";import"./SelectMulti-BMDK2H7z.js";const M=({id:t,page:a,perPage:c})=>{const d=T(),[o,n]=m.useState(!1),u=()=>{d(H(t)).then(h=>{const i=h.payload;i.success?(n(!o),k("Form successfully deleted."),C()):f.error(i.error)}).catch(h=>{f.error(h)})},p=[e.jsx(S,{style:g.DANGER,onClick:()=>{u()},children:s("Yes, delete it")}),e.jsx(S,{style:g.SECONDARY,onClick:()=>{n(!o)},children:s("Return back to list")})];return e.jsxs(N.Fragment,{children:[e.jsx(L,{title:s("Delete form"),buttons:p,visible:o,children:e.jsx("div",{children:s("You are going to delete this form. Are you sure?")})}),e.jsx("a",{className:`color-${g.DANGER}`,href:"#",onClick:h=>{h.preventDefault(),n(!o)},children:s("Delete")})]})};M.propTypes={page:b.number,perPage:b.number,id:b.string.isRequired};const P=({id:t})=>{const[a,c]=m.useState({}),[d,o]=m.useState(!1);return m.useEffect(()=>{d===!0&&F("exportCodeAction",{belongsTo:"form",find:t}).then(n=>{c(n)}).catch(n=>{console.error(n.message)})},[d]),e.jsxs(N.Fragment,{children:[e.jsx(L,{title:s("Export code"),visible:d,textAlign:"left",children:e.jsx(re,{language:"php",code:a.acpt,editable:!1})}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),o(!d)},children:s("Export code")})]})};P.propTypes={id:b.string.isRequired};const O=m.memo(({record:t})=>{const{register:a}=oe(),c=`elements.${t.id}`,d=()=>{F("duplicateAction",{belongsTo:"form",find:t.id}).then(o=>{o.success===!0?(k("Form successfully duplicated."),R(),C()):f.error(o.error)}).catch(o=>{console.error(o),f.error(s("Unknown error, please retry later"))})};return e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":`select-${t.name}`,className:"checkbox",htmlFor:c,children:[e.jsx("input",{type:"checkbox",id:c,name:c,defaultChecked:!1,...a(c)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.label}),e.jsx("td",{children:ie(t.action)}),e.jsx("td",{children:e.jsx(te,{text:`[acpt_form id="${t.key}"]`})}),e.jsx("td",{children:e.jsx(G,{name:"form-menu",buttonClass:g.SECONDARY,anchor:e.jsx(W,{icon:"bx:dots-vertical-rounded",color:z(),width:24}),links:[e.jsx(y,{mode:"edit",record:t}),e.jsx(E,{to:`/form/${t.id}`,children:s("Manage")}),e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),d()},children:s("Duplicate")}),e.jsx(M,{id:t.id}),e.jsx(P,{id:t.id}),e.jsx(E,{to:`/form-submissions/${t.id}`,className:"color-warning",children:s("Submissions")})]})})]})});O.propTypes={record:b.object.isRequired};const de=()=>{const t=document.globals,a=t.settings,c=t.globals,[d,o]=m.useReducer(r=>r+1,0),n=m.useRef(),u=ne({mode:"all"}),p=le({control:u.control,name:"elements"}),h=T(),{data:i,loading:$}=J(r=>r.fetchForms),{page:x}=I(),v=(a==null?void 0:a.length)>0&&w(a,"key","records_per_page")!==""?w(a,"key","records_per_page").value:20,A=Math.ceil(i.count/v);m.useEffect(()=>{K(s("Forms list")),Q("#/forms"),h(X({page:x||1,perPage:v})).then(r=>{U()})},[x]),m.useEffect(()=>{(()=>{if(!p)return!1;let l=0;for(const[j,Y]of Object.entries(p))Y===!0&&l++;return l===Object.entries(p).length})()?n.current.checked=!0:n.current&&(n.current.checked=!1)},[p]),document.addEventListener("restoredElement",function(){o()});const _=r=>{u.reset(),r.belongsTo="form";const l=r.action;if(l)switch(l){case"hide":ee(r);break;case"delete":case"duplicate":F("bulkActionsAction",r).then(j=>{if(j.success===!0){switch(l){case"delete":k("Form successfully deleted.");break;case"duplicate":k("Form successfully duplicated.");break}u.resetField("elements"),R(),C()}else f.error(j.error)}).catch(j=>{console.error(j),f.error(s("Unknown error, please retry later"))})}},B=r=>{i.records.filter(l=>!D(l.id,"form")).map(l=>{u.setValue(`elements.${l.id}`,r)})},q=[e.jsx(y,{mode:"save"})];return $?e.jsx(Z,{}):e.jsx(ae,{...u,children:e.jsx("form",{onSubmit:u.handleSubmit(_),children:e.jsxs(V,{actions:q,title:s("Forms list"),crumbs:[{label:s("Forms list")}],children:[e.jsx(ce,{belongsTo:"form"}),i.records&&i.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{className:`acpt-table rounded ${c.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:n,type:"checkbox",id:"all",defaultChecked:!1,onClick:r=>{i.records.map(l=>B(r.currentTarget.checked))}}),e.jsx("span",{})]})}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Action")}),e.jsx("th",{children:s("Shortcode")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:i.records&&i.records.map(r=>{if(!D(r.id,"form"))return e.jsx(O,{record:r},r.id)})}),A>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx(se,{currentPage:x?parseInt(x):1,totalPages:A,baseLink:"/forms"})})})})]})}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s("No forms found.")}),e.jsx("div",{children:e.jsx(y,{style:g.SECONDARY,mode:"save"})})]})})]})})})};de.propTypes={};export{de as default};
