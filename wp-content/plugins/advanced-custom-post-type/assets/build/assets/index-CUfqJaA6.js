import{j as e,u as s}from"./fields-Uuj9pZLj.js";import{a as _,R as w,u as G}from"./vendor-D21mNUGX.js";import{L as V,n as N}from"./Layout-CbPpDR-w.js";import{u as C,c as P,b as B,a as U,F as H}from"./index.esm-DCQn2FO4.js";import{u as W}from"./index-DRV1MUeg.js";import{P as y,u as k,B as x,s as b,bZ as $,I as z,a as D,b_ as F,D as M,b$ as T,c0 as Z,c1 as J,m as K,c as E,c2 as Q,c3 as X,L as ee,c4 as se}from"./index-DW87FRXD.js";import{I}from"./InputHidden-Sd_YdD40.js";import{T as O}from"./index-D3iHHJgH.js";import{S as te}from"./Select-Cp1uHe-V.js";import{M as q}from"./index-mrXLwnSf.js";import"./index-Cwt3Qm9G.js";const Y=({id:l,index:u})=>{const n=k(),[c,h]=_.useState(!1),{control:a}=C(),{remove:v}=P({control:a,name:"items"}),r=[e.jsx(x,{style:b.SUCCESS,onClick:i=>{i.preventDefault(),n($({id:l})),v(u),h(!c)},children:s("Yes")}),e.jsx(x,{style:b.DANGER,onClick:i=>{i.preventDefault(),h(!c)},children:s("No")})];return e.jsxs("span",{children:[e.jsx(q,{title:s("Confirm deleting permission"),visible:c,buttons:r,children:s("Are you sure?")}),e.jsx("a",{href:"#",onClick:i=>{i.preventDefault(),h(!c)},children:e.jsx(O,{icon:!1,tip:s("Delete"),label:e.jsx(z,{icon:"bx-trash",width:18,color:"#F94144"})})})]})};Y.propTypes={id:y.string.isRequired,index:y.number.isRequired};const L=({item:l,index:u,entityId:n,permissions:c})=>{const h=k(),{selectedElements:a}=D(o=>o.permissionState),v=()=>a.filter(p=>p.id===l.id).length>0,r=o=>`items.${u}.${o}`,{register:i,formState:{errors:j}}=C();return e.jsxs(w.Fragment,{children:[e.jsx(I,{id:r("id"),value:l.id,register:i}),e.jsx(I,{id:r("entityId"),value:n,register:i}),e.jsxs("tr",{id:l.id,children:[e.jsx("td",{children:e.jsx(O,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${l.id}`,children:[e.jsx("input",{id:`select-${l.id}`,type:"checkbox",checked:v(),onChange:o=>{h(F({element:l,selected:o.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:s(v()?"Deselect this element":"Select this element")})}),e.jsx("td",{children:e.jsx("div",{style:{width:"200px"},children:e.jsx(te,{register:i,id:r("userRole"),values:document.globals.globals.roles,errors:j,defaultValue:l.userRole})})}),c.map(o=>{const p=r(`permissions.${o.value}`);return e.jsx("td",{style:c.length>4?{padding:"24px 8px"}:{},children:e.jsxs("label",{className:"checkbox",htmlFor:p,children:[e.jsx("input",{name:p,value:!0,defaultChecked:l.permissions[o.value]===!0,type:"checkbox",id:p,...i(p,{})}),e.jsx("span",{})]})})}),e.jsx("td",{children:e.jsx(Y,{id:l.id,index:u})})]})]})};L.propTypes={item:y.object.isRequired,index:y.number.isRequired,entityId:y.string.isRequired,permissions:y.array.isRequired};const le=()=>{const l=k(),{items:u,selectedElements:n}=D(d=>d.permissionState),{control:c,setValue:h,getValues:a}=C(),v=B({control:c,name:"items"}),{append:r,remove:i}=P({control:c,name:"items"}),j=_.useRef(null),[o,p]=_.useState(null),A=()=>{n.map(d=>{switch(o){case"duplicate":const S=M(),f={id:S,label:d.label,value:d.value,isDefault:!1,sort:v.length+1};l(T(f)),r({id:S,label:d.label,value:d.value});break;case"delete":const g=a("items").filter(t=>t.id!==d.id);h("items",g),l($({id:d.id}));break}}),l(Z())};if(n.length>0)return e.jsxs("div",{className:"flex-between",children:[e.jsx("div",{className:"i-flex-center s-8",children:e.jsxs("span",{children:[n.length," ",s("Selected items")]})}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:j,className:"form-control sm",onChange:d=>{p(d.target.value!==""?d.target.value:null)},children:[e.jsx("option",{value:"",children:s("Select")}),e.jsx("option",{value:"duplicate",children:s("Duplicate")}),e.jsx("option",{value:"delete",children:s("Delete")})]}),e.jsx(x,{style:b.WHITE,size:"sm",disabled:o===null,onClick:d=>{d.preventDefault(),A()},children:s("Execute")})]})]})},ie=()=>{const l=k(),[u,n]=_.useState(!1),{unregister:c}=C(),h=[e.jsx(x,{style:b.SUCCESS,onClick:a=>{a.preventDefault(),l(J()),c("items"),n(!u)},children:s("Yes")}),e.jsx(x,{style:b.DANGER,onClick:a=>{a.preventDefault(),n(!u)},children:s("No")})];return e.jsxs(w.Fragment,{children:[e.jsx(q,{title:s("Confirm deleting all"),visible:u,buttons:h,children:s("Are you sure?")}),e.jsx(x,{type:"button",style:b.DANGER,onClick:a=>{a.preventDefault(),n(!u)},children:s("Delete all")})]})},be=()=>{const l=document.globals;l.settings;const u=l.globals,n=k(),{data:c,loading:h}=D(t=>t.fetchPermission),{items:a}=D(t=>t.permissionState),[v]=W(),{type:r,entity:i,id:j}=G();_.useEffect(()=>{K(s("Permissions")),r==="taxonomy"?E("#/taxonomies"):r==="page"&&E("#/option-pages"),n(Q(j)).then(t=>{t.payload&&n(X(t.payload))}).catch(t=>{console.error(t)})},[r,i,j]);const o=U({mode:"all"}),p=()=>{let t;r==="taxonomy"?t={edit:!0,manage:!0,assign:!0,delete:!0}:r==="page"?t={edit:!0,read:!0}:t={edit_s:!0,edit_private_s:!0,edit_published_s:!0,edit_others_s:!0,publish_s:!0,read_private_s:!0,delete_s:!0,delete_private_s:!0,delete_published_s:!0,delete_others_s:!0};const m={id:M(),entityId:j,userRole:"editor",permissions:t,sort:a.length+1};n(T(m))},A=t=>{a&&a.map(m=>{n(F({element:m,selected:t}))})},d=t=>{n(se({entityId:j,...t})).then(m=>{const R=m.payload;R.success?N.success(s("Permissions successfully saved")):N.error(R.error)})},S=[e.jsx(x,{style:b.SECONDARY,type:"button",onClick:()=>{p()},children:s("Add permission")}),e.jsx(x,{testId:"save-form",style:b.PRIMARY,type:"submit",children:s("Save")}),e.jsx(ie,{})];let f=[];const g=[];switch(r){case"post":g.push({label:s("Registered Custom Post Types"),link:"/"}),g.push({label:i,link:`/view/${i}`}),f=[{label:s("Edit"),value:"edit_s"},{label:s("Edit private"),value:"edit_private_s"},{label:s("Edit published"),value:"edit_published_s"},{label:s("Edit others"),value:"edit_others_s"},{label:s("Publish"),value:"publish_s"},{label:s("Read"),value:"read_private_s"},{label:s("Delete"),value:"delete_s"},{label:s("Delete private"),value:"delete_private_s"},{label:s("Delete published"),value:"delete_published_s"},{label:s("Delete others"),value:"delete_others_s"}];break;case"taxonomy":g.push({label:s("Registered Taxonomies"),link:"/taxonomies"}),g.push({label:i,link:`/view_taxonomy/${i}`}),f=[{label:s("Edit"),value:"edit"},{label:s("Manage"),value:"manage"},{label:s("Assign"),value:"assign"},{label:s("Delete"),value:"delete"}];break;case"page":g.push({label:s("Option pages"),link:"/option-pages"}),f=[{label:s("Edit"),value:"edit"},{label:s("Read"),value:"read"}];break}return g.push({label:`${s("Manage permissions of")} ${i}`}),h?e.jsx(ee,{}):e.jsx(H,{...o,children:e.jsx("form",{onSubmit:o.handleSubmit(d),children:e.jsx(V,{title:`${s("Manage permissions")} ${i}`,actions:S,crumbs:g,children:a&&a.length>0?e.jsxs("div",{className:"flex-column s-24",ref:v,children:[e.jsx(le,{}),e.jsx("div",{className:"bg-white b-rounded with-shadow",children:e.jsxs("div",{className:"responsive",children:[e.jsxs("table",{className:`acpt-table ${u.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-all",children:[e.jsx("input",{id:"select-all",type:"checkbox",onChange:t=>{A(t.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{style:{width:"200px"},children:s("User role")}),f.map(t=>{var m;return e.jsx("th",{style:((m=f)===null||m===void 0?void 0:m.length)>4?{padding:"24px 8px"}:{},className:f.length>4?"font-sm":"",children:t.label})}),e.jsx("th",{style:{width:"10px"}})]})}),e.jsx("tbody",{ref:v,children:a.map((t,m)=>e.jsx(L,{permissions:f,index:m,entityId:j,item:t},t.id))})]}),e.jsx("div",{className:"b-top-1 p-24",children:e.jsx(x,{style:b.SECONDARY,type:"button",onClick:()=>{p()},children:s("Add permission")})})]})})]}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s("No permissions found.")}),e.jsx("div",{children:e.jsx(x,{style:b.SECONDARY,type:"button",onClick:()=>{p()},children:s("Add permission")})})]})})})})})};export{be as default};
