import{j as e,u as s}from"./fields-Uuj9pZLj.js";import{a as m,R as A,L as j,u as H}from"./vendor-D21mNUGX.js";import{s as _,n as C,D as X,a as F,f as z,L as J}from"./Layout-CbPpDR-w.js";import{P as T,b as w,u as L,B as R,s as u,A as M,bX as K,r as O,bY as D,I as Q,p as Z,w as N,a as ee,m as se,j as te,L as oe,q as $,t as ne}from"./index-DW87FRXD.js";import{T as Y}from"./index-D3iHHJgH.js";import{E as le}from"./index-CKuX73qi.js";import{E as ae}from"./index-n0xjyagi.js";import{F as re,E as ce}from"./FieldGroupsModal-BkHvLyRt.js";import{m as g}from"./metaTypes-Bb9tjSPe.js";import{M as U}from"./index-mrXLwnSf.js";import{u as q,a as ie,b as de,F as me}from"./index.esm-DCQn2FO4.js";import{P as ue}from"./index-DfOJf81u.js";import{B as he}from"./index-DU1xUoYR.js";import{u as pe}from"./index-DRV1MUeg.js";import{B as xe}from"./index-C2f65238.js";import"./index-Cwt3Qm9G.js";import"./index-CTmKXGMM.js";import"./index-DbbBejw-.js";import"./index-kc5wfrYu.js";const I=({postType:t,page:b,perPage:r})=>{const h=document.globals.settings,f=w(h,"key","delete_posts").value,{reset:p}=q(),a=L(),[c,x]=m.useState(!1),l=()=>{a(K(t,"all")).then(i=>{const o=i.payload;o.success?(p(),x(!c),_("Custom post type successfully deleted."),O()):C.error(o.error)}).catch(i=>{C.error(i)})},k=[e.jsx(R,{style:u.DANGER,onClick:()=>{l()},children:s("Yes, delete it")}),e.jsx(R,{style:u.SECONDARY,onClick:()=>{x(!c)},children:s("Return back to list")})];return e.jsxs(A.Fragment,{children:[e.jsxs(U,{title:s("Delete custom post type"),buttons:k,visible:c,children:[e.jsx("div",{children:s("You are going to delete this custom post type. Are you sure?")}),f&&e.jsx("div",{className:"mt-24",children:e.jsx(M,{style:u.WARNING,children:s("WARNING: This action will delete all posts and metadata for this post type. The action is irreversible.")})})]}),e.jsx("a",{href:"#",className:`color-${u.DANGER}`,onClick:i=>{i.preventDefault(),x(!c)},children:s("Delete")})]})};I.propTypes={page:T.number.isRequired,perPage:T.number.isRequired,postType:T.string.isRequired};const W=m.memo(({record:t,showWooCommerceColumn:b,page:r,perPage:y})=>{var h,f;const{register:p}=q(),a=`elements.${t.name}`,c=()=>t.name==="attachment"?"/register_meta?belongsTo=media&find=All%20formats":`/register_meta?belongsTo=${g.CUSTOM_POST_TYPE}&find=${t.name}`,x=()=>{N("duplicateAction",{belongsTo:g.CUSTOM_POST_TYPE,find:t.name}).then(l=>{l.success===!0?(_("Custom post type successfully duplicated."),F(),O()):C.error(l.error)}).catch(l=>{console.error(l),C.error(s("Unknown error, please retry later"))})};return e.jsx(A.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:!t.isNative&&e.jsxs("label",{className:"checkbox",htmlFor:a,"data-cy":`select-${t.name}`,children:[e.jsx("input",{type:"checkbox",id:a,name:a,defaultChecked:!1,...p(a)}),e.jsx("span",{})]})}),e.jsx("td",{children:e.jsx(le,{value:t.icon})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:e.jsx(ae,{element:t})}),e.jsx("td",{children:D(t,"taxonomies")&&((h=t.taxonomies)===null||h===void 0?void 0:h.length)>0?e.jsx(j,{to:`/assoc-taxonomy-post/${t.name}`,children:s("Manage")}):e.jsx(j,{to:`/assoc-taxonomy-post/${t.name}`,children:s("Associate")})}),b&&e.jsx("td",{children:t.isWooCommerce===!0&&e.jsx(A.Fragment,{children:D(t,"woocommerceProductData")&&((f=t.woocommerceProductData)===null||f===void 0?void 0:f.length)>0?e.jsx(j,{to:`/product-data/${t.name}`,children:s("Manage")}):e.jsx(j,{to:`/product-data/${t.name}`,children:s("Create")})})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(j,{to:c(),children:s("Create")}),e.jsx(re,{find:t.name,belongsTo:g.CUSTOM_POST_TYPE})]})}),e.jsx("td",{children:!t.isNative&&e.jsx(X,{name:"custom-post-type-menu",buttonClass:u.SECONDARY,anchor:e.jsx(Q,{icon:"bx:dots-vertical-rounded",color:Z(),width:24}),links:[e.jsx(j,{to:`view/${t.name}`,children:s("View")}),e.jsx(j,{to:`edit/${t.name}`,children:s("Edit")}),e.jsx("a",{href:"#",onClick:l=>{l.preventDefault(),x()},children:s("Duplicate")}),e.jsx(I,{page:r,perPage:y,postType:t.name}),e.jsx(ce,{belongsTo:g.CUSTOM_POST_TYPE,find:t.name}),e.jsx(j,{to:`/permissions/post/${t.name}/${t.id}`,className:"color-warning",children:s("Permissions")})]})})]})})});W.propTypes={page:T.number.isRequired,perPage:T.number.isRequired,record:T.object.isRequired,showWooCommerceColumn:T.bool.isRequired};const fe=()=>{const b=document.globals.globals,[r,y]=m.useState(!1),[h,f]=m.useState([]),[p,a]=m.useState(!1),[c,x]=m.useState([]);m.useEffect(()=>{r===!0&&(a(!0),N("fetchPostTypesAction",{}).then(o=>{f(o),a(!1)}).catch(o=>{console.error(o.message),a(!1)}))},[r]);const l=()=>{N("syncPostsAction",{postTypes:c}).then(o=>{o.success&&(_("Successfully post sync."),O()),o.error&&C.error(error),y(!r)}).catch(o=>{console.error(o.message)})},k=(o,P)=>{x(P===!0?S=>[...S,o]:S=>S.filter(v=>v!==o))},i=[e.jsx(R,{style:u.PRIMARY,disabled:c.length===0,onClick:()=>{l()},children:s("Sync")}),e.jsx(R,{style:u.SECONDARY,onClick:()=>{y(!r)},children:s("Return back to list")})];return e.jsxs(A.Fragment,{children:[e.jsx(U,{title:s("Sync with post types"),buttons:i,visible:r,children:p?e.jsx("div",{children:"Loading..."}):e.jsx(A.Fragment,{children:h&&h.length>0?e.jsx("div",{className:"responsive",children:e.jsx("table",{className:`acpt-table spaceless ${b.is_rtl?"rtl":""}`,children:e.jsx("tbody",{children:h.map(o=>e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("label",{className:"checkbox",htmlFor:`select_${o.name}`,children:[e.jsx("input",{name:`select_${o.name}`,defaultChecked:!1,type:"checkbox",id:`select_${o.name}`,onChange:P=>k(o.name,P.target.checked)}),e.jsx("span",{children:o.label})]})})}))})})}):e.jsx(M,{style:u.SECONDARY,children:s("No custom post type found.")})})}),e.jsx(R,{type:"button",style:u.SECONDARY,onClick:o=>{o.preventDefault(),y(!r)},children:s("Sync with post types")})]})},$e=()=>{var t;const b=document.globals,r=b.settings,y=b.globals,[h,f]=m.useReducer(n=>n+1,0);pe();const p=m.useRef(),a=ie({mode:"all"}),c=de({control:a.control,name:"elements"}),x=L(),{data:l,loading:k}=ee(n=>n.fetchCustomPostTypes),{page:i}=H(),o=(r==null?void 0:r.length)>0&&w(r,"key","records_per_page")!==""?w(r,"key","records_per_page").value:20,P=Math.ceil(l.count/o);m.useEffect(()=>{se(s("Registered Custom Post Types")),x(te({page:i||1,perPage:o})).then(n=>{z()})},[i]),m.useEffect(()=>{(()=>{if(!c)return!1;let d=0;for(const[E,V]of Object.entries(c))V===!0&&d++;return d===Object.entries(c).length})()?p.current.checked=!0:p.current&&(p.current.checked=!1)},[c]),document.addEventListener("restoredElement",function(){f()});const S=n=>{a.reset(),n.belongsTo=g.CUSTOM_POST_TYPE;const d=n.action;if(d){switch(d){case"hide":ne(n);break;case"delete":case"duplicate":N("bulkActionsAction",n).then(E=>{if(E.success===!0){switch(d){case"delete":_("Custom post type successfully deleted.");break;case"duplicate":_("Custom post type successfully duplicated.");break}F(),O()}else C.error(E.error)}).catch(E=>{console.error(E),C.error(s("Unknown error, please retry later"))});break}a.resetField("elements")}},v=()=>{if(!l.records)return!1;let n=0;return l.records.map(d=>{d.isWooCommerce===!0&&n++}),n>0},B=n=>{l.records.filter(d=>d.isNative===!1).filter(d=>!$(d.name,g.CUSTOM_POST_TYPE)).map(d=>{a.setValue(`elements.${d.name}`,n)})},G=[e.jsx(he,{style:u.PRIMARY,to:"/register",children:s("Register new Post Type")}),e.jsx(fe,{})];return k?e.jsx(oe,{}):e.jsx(me,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(S),children:e.jsxs(J,{title:s("Registered Custom Post Types"),actions:G,crumbs:[{label:s("Registered Custom Post Types")}],children:[e.jsx(xe,{belongsTo:g.CUSTOM_POST_TYPE}),l.records&&((t=l.records)===null||t===void 0?void 0:t.length)>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{"data-cy":"cpt-table",className:`acpt-table rounded ${y.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":"select-all",className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:p,type:"checkbox",id:"all",defaultChecked:!1,onClick:n=>B(n.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Type")}),e.jsx("th",{children:e.jsx(Y,{tip:s("Associated taxonomies with the post"),label:s("Associated taxonomies")})}),v()&&e.jsx("th",{children:e.jsx(Y,{tip:s("Associated WooCommerce product data"),label:s("Product data")})}),e.jsx("th",{children:s("Field groups")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:l.records&&l.records.map(n=>{if(!$(n.name,g.CUSTOM_POST_TYPE))return e.jsx(W,{record:n,page:i,perPage:o,showWooCommerceColumn:v()},n.id)})}),P>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:v()?8:7,children:e.jsx(ue,{currentPage:i?parseInt(i):1,totalPages:P,baseLink:""})})})})]})}):e.jsxs(M,{style:u.SECONDARY,children:[s("No custom post types found.")," ",e.jsx(j,{to:"/register",children:s("Register the first one")}),"!"]})]})})})};export{$e as default};
