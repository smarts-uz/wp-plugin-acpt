import{j as e,u as s}from"./fields-Uuj9pZLj.js";import{a as g,R,L as W,u as J}from"./vendor-D21mNUGX.js";import{a as _,F as $,u as K,b as Q}from"./index.esm-DCQn2FO4.js";import{n as b,s as S,D as X,a as w,f as Z,L as ee}from"./Layout-CbPpDR-w.js";import{P as p,s as x,u as E,i as P,B as D,a9 as se,aa as q,ab as te,r as L,I as ae,p as le,w as Y,a as re,b as F,m as ne,c as ie,L as oe,q as T,t as ce}from"./index-DW87FRXD.js";import{M as V}from"./index-mrXLwnSf.js";import{I}from"./InputHidden-Sd_YdD40.js";import{L as M}from"./Label-DH8FgXCw.js";import{I as O}from"./Input-Dag95jow.js";import{d as de,w as ue}from"./bundle.esm.min-B-HQpnrw.js";import{a as me}from"./validation-dtG0NF0D.js";import{B as he}from"./index-C2f65238.js";import{P as pe}from"./index-DfOJf81u.js";import"./index-DRV1MUeg.js";import"./metaTypes-Bb9tjSPe.js";const A=({record:t,page:f,perPage:o,mode:h="save",style:n})=>{const j=E(),[d,c]=g.useState(!1),[i,v]=g.useState(!0),a=_({mode:"onChange"}),N=()=>e.jsxs("div",{className:"flex-between s-8",children:[e.jsx("span",{children:s("Dataset label")}),e.jsx("a",{href:"#",onClick:l=>{l.preventDefault(),v(!i)},children:s(`${i?"Auto slug ON":"Auto slug OFF"}`)})]}),u=l=>{j(se(l)).then(k=>{const C=k.payload;C.success?(c(!d),b.success(s("Dataset successfully saved")),j(q({page:f||1,perPage:o}))):b.error(C.error)})};return e.jsxs(R.Fragment,{children:[e.jsx(V,{size:"large",title:s(t?"Edit dataset":"Create a new dataset"),visible:d,buttons:[],children:e.jsx($,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(u),children:[e.jsx(I,{register:a.register,id:"emptyItems",value:0}),e.jsxs("div",{className:"flex-column s-24",children:[t&&e.jsx(R.Fragment,{children:e.jsx(I,{register:a.register,id:"id",value:t.id})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(M,{id:"label",label:N()}),e.jsx(O,{id:"label",register:a.register,placeholder:s("Dataset label"),defaultValue:h==="edit"&&!P(t)?t.label:"dataset name",errors:a.formState.errors,onChangeCapture:l=>{i&&a.setValue("name",de(ue(l.target.value)))},onClick:l=>{(l.target.value==="dataset_name"||l.target.value==="dataset name")&&a.resetField("label")},validate:{maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(M,{id:"name",label:s("Dataset name")}),e.jsx(O,{id:"name",register:a.register,placeholder:s("Dataset name"),defaultValue:h==="edit"&&!P(t)?t.name:"dataset_name",errors:a.formState.errors,isRequired:!0,onClick:l=>{(l.target.value==="dataset_name"||l.target.value==="dataset name")&&a.resetField("name")},validate:{validate:me,required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(D,{testId:"save-form",style:x.PRIMARY,type:"submit",children:s("Save")}),e.jsx(D,{style:x.DANGER,type:"button",onClick:()=>{c(!d)},children:s("Close")})]})]})]})})}),h==="save"?e.jsx(D,{testId:"create-form",type:"button",onClick:()=>{c(!d)},style:n||x.PRIMARY,children:s("Create dataset")}):e.jsx("a",{href:"#",onClick:l=>{l.preventDefault(),c(!d)},children:s("Edit")})]})};A.propTypes={mode:p.oneOf(["edit","save"]).isRequired,style:p.oneOf(Object.values(x)),page:p.number,perPage:p.number,record:p.object};const B=({id:t,page:f,perPage:o})=>{const h=E(),[n,j]=g.useState(!1),d=()=>{h(te(t)).then(i=>{const v=i.payload;v.success?(j(!n),S("Dataset successfully deleted."),L()):b.error(v.error)}).catch(i=>{b.error(i)})},c=[e.jsx(D,{style:x.DANGER,onClick:()=>{d()},children:s("Yes, delete it")}),e.jsx(D,{style:x.SECONDARY,onClick:()=>{j(!n)},children:s("Return back to list")})];return e.jsxs(R.Fragment,{children:[e.jsx(V,{title:s("Delete dataset"),buttons:c,visible:n,children:e.jsx("div",{children:s("You are going to delete this dataset. Are you sure?")})}),e.jsx("a",{className:`color-${x.DANGER}`,href:"#",onClick:i=>{i.preventDefault(),j(!n)},children:s("Delete")})]})};B.propTypes={page:p.number,perPage:p.number,id:p.string.isRequired};const G=({record:t})=>{const{register:f}=K(),o=`elements.${t.id}`,h=()=>{Y("duplicateAction",{belongsTo:"dataset",find:t.id}).then(n=>{n.success===!0?(S("Dataset successfully duplicated."),w(),L()):b.error(n.error)}).catch(n=>{console.error(n),b.error(s("Unknown error, please retry later"))})};return e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":`select-${t.name}`,className:"checkbox",htmlFor:o,children:[e.jsx("input",{type:"checkbox",id:o,name:o,defaultChecked:!1,...f(o)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.label}),e.jsx("td",{children:t.items.length}),e.jsx("td",{children:e.jsx(X,{name:"dataset-menu",buttonClass:x.SECONDARY,anchor:e.jsx(ae,{icon:"bx:dots-vertical-rounded",color:le(),width:24}),links:[e.jsx(A,{mode:"edit",record:t}),e.jsx(W,{to:`/tools/dataset/${t.id}`,children:s("Manage")}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),h()},children:s("Duplicate")}),e.jsx(B,{id:t.id})]})})]})};G.propTypes={record:p.object.isRequired};const Ee=()=>{var t;const f=document.globals,o=f.settings,h=f.globals,[n,j]=g.useReducer(r=>r+1,0),d=g.useRef(),c=_({mode:"all"}),i=Q({control:c.control,name:"elements"}),v=E(),{data:a,loading:N}=re(r=>r.fetchDatasets),{page:u}=J(),l=(o==null?void 0:o.length)>0&&F(o,"key","records_per_page")!==""?F(o,"key","records_per_page").value:20,k=Math.ceil(a.count/l);g.useEffect(()=>{w(),ne(s("Dataset list")),ie("#/tools"),v(q({page:u||1,perPage:l})).then(r=>{Z()})},[u]),g.useEffect(()=>{(()=>{if(!i)return!1;let m=0;for(const[y,z]of Object.entries(i))z===!0&&m++;return m===Object.entries(i).length})()?d.current.checked=!0:d.current&&(d.current.checked=!1)},[i]),document.addEventListener("restoredElement",function(){j()});const C=r=>{c.reset(),r.belongsTo="dataset";const m=r.action;if(m)switch(m){case"hide":ce(r);break;case"delete":case"duplicate":Y("bulkActionsAction",r).then(y=>{if(y.success===!0){switch(m){case"delete":S("Dataset successfully deleted.");break;case"duplicate":S("Dataset successfully duplicated.");break}c.resetField("elements"),w(),L()}else b.error(y.error)}).catch(y=>{console.error(y),b.error(s("Unknown error, please retry later"))})}},U=r=>{a.records.filter(m=>!T(m.id,"dataset")).map(m=>{c.setValue(`elements.${m.id}`,r)})},H=[e.jsx(A,{page:u||1,perPage:l,mode:"save"})];return N?e.jsx(oe,{}):e.jsx($,{...c,children:e.jsx("form",{onSubmit:c.handleSubmit(C),children:e.jsxs(ee,{title:s("Dataset"),actions:H,crumbs:[{label:s("ACPT Tools"),link:"/tools"},{label:s("Dataset")}],children:[e.jsx(he,{belongsTo:"dataset"}),a.records&&((t=a.records)===null||t===void 0?void 0:t.length)>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{className:`acpt-table rounded ${h.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:d,type:"checkbox",id:"all",defaultChecked:!1,onClick:r=>U(r.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Items count")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:a.records&&a.records.map(r=>{if(!T(r.id,"dataset"))return e.jsx(G,{record:r},r.id)})}),k>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx(pe,{currentPage:u?parseInt(u):1,totalPages:k,baseLink:"/tools/dataset"})})})})]})}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s("No dataset found.")}),e.jsx("div",{children:e.jsx(A,{style:x.SECONDARY,page:u||1,perPage:l,mode:"save"})})]})})]})})})};export{Ee as default};
