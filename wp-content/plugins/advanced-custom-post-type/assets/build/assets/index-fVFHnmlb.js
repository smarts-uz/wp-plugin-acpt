import{j as e,u as t}from"./fields-Uuj9pZLj.js";import{a as p,R as S,L as A,u as G}from"./vendor-D21mNUGX.js";import{u as U,a as V,b as H,F as K}from"./index.esm-DCQn2FO4.js";import{s as y,n as f,D as W,a as v,f as z,L as J}from"./Layout-CbPpDR-w.js";import{B}from"./index-DU1xUoYR.js";import{P as k,u as L,B as N,s as x,n as Q,r as w,w as C,I as X,p as Z,a as ee,b as R,m as se,c as te,o as le,L as oe,q as T,t as re}from"./index-DW87FRXD.js";import{B as ce}from"./index-C2f65238.js";import{P as ne}from"./index-DfOJf81u.js";import{E as ae}from"./index-CKuX73qi.js";import{M as P}from"./index-mrXLwnSf.js";import{C as ie}from"./index-DbbBejw-.js";import{B as de}from"./BlockListElementCategory-CrEhB2EV.js";import"./index-DRV1MUeg.js";import"./metaTypes-Bb9tjSPe.js";import"./index-kc5wfrYu.js";const M=({id:s,page:h,perPage:c})=>{const a=L(),[n,r]=p.useState(!1),o=()=>{a(Q(s)).then(i=>{const g=i.payload;g.success?(r(!n),y("Block successfully deleted."),w()):f.error(g.error)}).catch(i=>{f.error(i)})},u=[e.jsx(N,{style:x.DANGER,onClick:()=>{o()},children:t("Yes, delete it")}),e.jsx(N,{style:x.SECONDARY,onClick:()=>{r(!n)},children:t("Return back to list")})];return e.jsxs(S.Fragment,{children:[e.jsx(P,{title:t("Delete block"),buttons:u,visible:n,children:e.jsx("div",{children:t("You are going to delete this block. Are you sure?")})}),e.jsx("a",{className:`color-${x.DANGER}`,href:"#",onClick:i=>{i.preventDefault(),r(!n)},children:t("Delete")})]})};M.propTypes={page:k.number,perPage:k.number,id:k.string.isRequired};const F=({id:s})=>{const[h,c]=p.useState({}),[a,n]=p.useState(!1);return p.useEffect(()=>{a===!0&&C("exportCodeAction",{belongsTo:"block",find:s}).then(r=>{c(r)}).catch(r=>{console.error(r.message)})},[a]),e.jsxs(S.Fragment,{children:[e.jsx(P,{title:t("Export code"),visible:a,textAlign:"left",children:e.jsx(ie,{language:"php",code:h.acpt,editable:!1})}),e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),n(!a)},children:t("Export code")})]})};F.propTypes={id:k.string.isRequired};const _=({record:s})=>{var h,c;const{register:a}=U(),n=`elements.${s.id}`,r=()=>{C("duplicateAction",{belongsTo:"block",find:s.id}).then(o=>{o.success===!0?(y("Dataset successfully duplicated."),v(),w()):f.error(o.error)}).catch(o=>{console.error(o),f.error(t("Unknown error, please retry later"))})};return e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":`select-${s.name}`,className:"checkbox",htmlFor:n,children:[e.jsx("input",{type:"checkbox",id:n,name:n,defaultChecked:!1,...a(n)}),e.jsx("span",{})]})}),e.jsx("td",{children:e.jsx(ae,{value:s.icon.src?s.icon.src:s.icon})}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.title}),e.jsx("td",{children:e.jsx(de,{category:s.category})}),e.jsx("td",{children:s.keywords&&((h=s.keywords)===null||h===void 0?void 0:h.length)>0&&e.jsx("div",{className:"i-flex-center s-8",children:s.keywords&&s.keywords.map(o=>e.jsx("span",{className:"acpt-badge acpt-badge-default",children:o}))})}),e.jsx("td",{children:s.postTypes&&((c=s.postTypes)===null||c===void 0?void 0:c.length)>0&&e.jsx("div",{className:"i-flex-center s-8",children:s.postTypes.join(", ")})}),e.jsx("td",{children:e.jsx(W,{name:"block-menu",buttonClass:x.SECONDARY,anchor:e.jsx(X,{icon:"bx:dots-vertical-rounded",color:Z(),width:24}),links:[e.jsx(A,{to:`/view_block/${s.id}`,children:t("View")}),e.jsx(A,{to:`/block/${s.id}`,children:t("Edit")}),e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),r()},children:t("Duplicate")}),e.jsx(M,{id:s.id}),e.jsx(F,{id:s.id})]})})]})};_.propTypes={record:k.object.isRequired};const De=()=>{var s;const h=document.globals,c=h.settings,a=h.globals,[n,r]=p.useReducer(l=>l+1,0),o=p.useRef(),u=V({mode:"all"}),i=H({control:u.control,name:"elements"}),g=L(),{data:m,loading:$}=ee(l=>l.fetchBlocks),{page:j}=G(),E=(c==null?void 0:c.length)>0&&R(c,"key","records_per_page")!==""?R(c,"key","records_per_page").value:20,D=Math.ceil(m.count/E);p.useEffect(()=>{v(),se(t("Dynamic blocks list")),te("#/blocks"),g(le({page:j||1,perPage:E})).then(l=>{z()})},[j]),p.useEffect(()=>{(()=>{if(!i)return!1;let d=0;for(const[b,q]of Object.entries(i))q===!0&&d++;return d===Object.entries(i).length})()?o.current.checked=!0:o.current&&(o.current.checked=!1)},[i]),document.addEventListener("restoredElement",function(){r()});const O=l=>{u.reset(),l.belongsTo="block";const d=l.action;if(d)switch(d){case"hide":re(l);break;case"delete":case"duplicate":C("bulkActionsAction",l).then(b=>{if(b.success===!0){switch(d){case"delete":y("Block successfully deleted.");break;case"duplicate":y("Block successfully duplicated.");break}u.resetField("elements"),v(),w()}else f.error(b.error)}).catch(b=>{console.error(b),f.error(t("Unknown error, please retry later"))})}},I=l=>{m.records.filter(d=>!T(d.id,"block")).map(d=>{u.setValue(`elements.${d.id}`,l)})},Y=[e.jsx(B,{style:x.PRIMARY,to:"/block",children:t("Create new block")})];return $?e.jsx(oe,{}):e.jsx(K,{...u,children:e.jsx("form",{onSubmit:u.handleSubmit(O),children:e.jsxs(J,{actions:Y,title:t("Dynamic blocks list"),crumbs:[{label:t("Dynamic blocks list")}],children:[e.jsx(ce,{belongsTo:"block"}),m.records&&((s=m.records)===null||s===void 0?void 0:s.length)>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{className:`acpt-table ${a.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:o,type:"checkbox",id:"all",defaultChecked:!1,onClick:l=>I(l.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{}),e.jsx("th",{children:t("Name")}),e.jsx("th",{children:t("Label")}),e.jsx("th",{children:t("Category")}),e.jsx("th",{children:t("Keywords")}),e.jsx("th",{children:t("Post types")}),e.jsx("th",{children:t("Actions")})]})}),e.jsx("tbody",{children:m.records&&m.records.map(l=>{if(!T(l.id,"block"))return e.jsx(_,{record:l},l.id)})}),D>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx(ne,{currentPage:j?parseInt(j):1,totalPages:D,baseLink:"/blocks"})})})})]})}):e.jsx("div",{className:"p-24 bg-white with-shadow",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:t("No block found.")}),e.jsx("div",{children:e.jsx(B,{style:x.SECONDARY,to:"/block",children:t("Create new block")})})]})})]})})})};export{De as default};
