import{j as e,u as s,s as xs,b as Pe,f as $}from"./fields-Uuj9pZLj.js";import{a as k,R as z,u as ye,h as bs}from"./vendor-D21mNUGX.js";import{S as oe,a as fs}from"./StepsHeader-E13EP3oN.js";import{P as l,I as W,B as L,s as D,w as Re,u as Y,a as K,v as He,x as ze,y as js,z as vs,C as ys,D as me,E as xe,F as ks,G as Ye,H as Cs,J as be,K as Ss,M as Ns,N as Ge,O as Rs,Q as ws,m as ke,c as Es,R as Be,S as Ts,T as qs,U as Is,V as As,W as Ds,X as Ls,Y as Os,o as Fs,L as Bs,Z as Ms,r as $s}from"./index-DW87FRXD.js";import{u as G,b as H,g as fe,a as ne,F as ie,c as X}from"./index.esm-DCQn2FO4.js";import{L as ce,b as _s,n as Ce,u as Me,D as Ps,a as Hs,s as zs}from"./Layout-CbPpDR-w.js";import{C as de}from"./index-Dp7DyYVn.js";import{I as _}from"./Input-Dag95jow.js";import{C as q}from"./CardRow-D0wbqPA3.js";import{I as $e}from"./IconPicker-C2NgdprL.js";import{C as _e,d as je,T as Ys}from"./Textarea-Bj5YRWIZ.js";import{S as we}from"./Select-Cp1uHe-V.js";import{C as Gs}from"./Checkbox-BnNcyaPE.js";import{d as le,w as ae}from"./bundle.esm.min-B-HQpnrw.js";import{a as Ee}from"./validation-dtG0NF0D.js";import{u as Te}from"./index-DRV1MUeg.js";import{u as qe,C as Ie,a as Ve}from"./sortable.esm-C-GypyhB.js";import{S as We}from"./index-DuvxZwho.js";import{T as U}from"./index-D3iHHJgH.js";import{M as Ae}from"./index-mrXLwnSf.js";import{M as Ue}from"./index-Bskps18W.js";import{I as Ke}from"./InputHidden-Sd_YdD40.js";import{L as V}from"./Label-DH8FgXCw.js";import{B as Vs}from"./ButtonSwitch-B9KeMXNd.js";import{T as A}from"./Toggle-C4UaD4f5.js";import{F as Xe}from"./index-kc5wfrYu.js";import{P as Ws}from"./index-DHZeBRHg.js";import{S as re}from"./SelectMulti-BMDK2H7z.js";import"./index-CKuX73qi.js";import"./index-Cwt3Qm9G.js";const J=({stepActive:n,setStepActive:a,setFormValues:g=null,steps:h})=>{const{getValues:m}=G();let u=[];for(const[i,t]of Object.entries(h))u.push(e.jsx("li",{className:`acpt-accordion-tab ${parseInt(i)===parseInt(n)?"active":""}`,onClick:()=>{g&&g(b=>(b[parseInt(n)+1]=m(),b)),a(i)},children:e.jsx("span",{children:t.title})},i));return e.jsx("div",{className:"acpt-tabs",children:e.jsx("ul",{role:"tablist",className:"tablist mb-12",children:u&&u.map(i=>i)})})};J.propTypes={setFormValues:l.func,setStepActive:l.func.isRequired,stepActive:l.number.isRequired,steps:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired};const Je=({icon:n})=>{const[a,g]=k.useState(n&&typeof n=="object"?"colors":"simple");k.useEffect(()=>{g(n&&typeof n=="object"?"colors":"simple")},[n]);const{formState:{errors:h},register:m,setValue:u}=G();return e.jsxs(z.Fragment,{children:[e.jsx(q,{label:s("Icon type"),value:e.jsxs("div",{children:[e.jsxs("ul",{className:"flex-column",children:[e.jsxs("li",{className:"i-flex-center s-4",children:[e.jsx("input",{id:"icon_type_simple",type:"radio",name:"icon_type",checked:a==="simple",onClick:i=>{g("simple")}}),e.jsx("label",{htmlFor:"icon_type_simple",children:"Simple"})]}),e.jsxs("li",{className:"i-flex-center s-4",children:[e.jsx("input",{id:"icon_type_colors",type:"radio",name:"icon_type",checked:a==="colors",onClick:i=>{g("colors")}}),e.jsx("label",{htmlFor:"icon_type_colors",children:"Colors"})]})]}),e.jsxs("div",{className:"flex-column s-4",children:[e.jsx("span",{children:"Simple: Specify a Dashicons class or SVG path"}),e.jsx("span",{children:"Colors: Specify colors & Dashicons class"})]})]})}),a==="simple"?e.jsx(q,{label:s("Icon"),value:e.jsx($e,{svg:!0,upload:!1,id:"icon",callback:i=>{u("icon",i)},defaultValue:typeof n=="string"&&n?n:null,register:m,errors:h,description:s("Choose the icon"),validate:{required:s("This field is mandatory")}})}):e.jsx(q,{label:s("Icon"),value:e.jsxs("div",{className:"flex-column s-24",children:[e.jsx("div",{children:e.jsx($e,{svg:!0,upload:!1,id:"icon.src",callback:i=>{u("icon.src",i)},defaultValue:n&&n.src?n.src:null,register:m,errors:h,description:s("Choose the icon"),validate:{required:s("This field is mandatory")}})}),e.jsx("div",{children:e.jsx(_e,{id:"icon.background",register:m,errors:h,defaultValue:n&&n.background?n.background:"#ffffff",description:s("The background color of the icon")})}),e.jsx("div",{children:e.jsx(_e,{id:"icon.foreground",register:m,errors:h,defaultValue:n&&n.foreground?n.foreground:"#000000",description:s("The foreground color of the icon")})})]})})]})};Je.propTypes={icon:l.oneOfType([l.string,l.object])};const Us=()=>{const[n,a]=k.useState(!1),{formState:{errors:g},register:h,control:m,getValues:u}=G(),i=H({control:m,name:"category"}),t=b=>b?!["text","media","design","widgets","theme","embed"].includes(b):!1;return k.useEffect(()=>{a(t(i))},[i]),e.jsx(q,{label:s("Block category"),value:e.jsxs(z.Fragment,{children:[n?e.jsx(_,{register:h,id:"category",description:s("The block category"),errors:g,isRequired:!0,validate:{required:s("This field is mandatory")}}):e.jsx(we,{register:h,id:"category",values:[{label:"Text",value:"text"},{label:"Media",value:"media"},{label:"Design",value:"design"},{label:"Widgets",value:"widgets"},{label:"Theme",value:"theme"},{label:"Embed",value:"embed"}],description:s("The block category"),errors:g}),e.jsx("a",{className:"mt-8",href:"#",onClick:b=>{b.preventDefault(),a(!n)},children:s(n?"Choose a standard category":"Enter a custom category")})]})})},Qe=({id:n,defaultValue:a,setValue:g,register:h,errors:m,description:u})=>{const i=fe(m,n),[t,b]=k.useState(a||[]);k.useEffect(()=>{b(a)},[a]);const c=o=>{if((o.keyCode===13||o.keyCode===188)&&(o.preventDefault(),o.stopPropagation(),o.target.value!=="")){const d=[...t,o.target.value];b(d),g(n,d),o.target.value=""}},r=o=>{let d=t.filter((x,f)=>o!==f);b(d),g(n,d)};return e.jsxs(z.Fragment,{children:[e.jsx("input",{id:n,name:n,type:"hidden",defaultValue:a,...h(n)}),t&&e.jsx("div",{className:"i-flex-center s-8 mb-12",children:t.map((o,d)=>e.jsx("div",{className:"acpt-badge acpt-badge-default",children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"mr-8",children:o}),e.jsx("span",{className:"cursor-pointer",onClick:x=>r(d),children:e.jsx(W,{icon:"bx-trash",width:14,color:"#F94144"})})]})}))}),e.jsx("input",{id:n,name:n,type:"text",placeholder:s("Enter whatever items you want; separate them with COMMA or ENTER."),className:`form-control ${i?"has-errors":""}`,onKeyDown:o=>c(o)}),i&&e.jsx("div",{"data-cy":`input-error-${n}`,className:"invalid-feedback",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:i.message}})}),u&&e.jsx("div",{className:"form-description",dangerouslySetInnerHTML:{__html:u}})]})};Qe.propTypes={id:l.string.isRequired,defaultValue:l.array,register:l.func.isRequired,errors:l.func.isRequired,setValue:l.func.isRequired,description:l.string};const Ze=({title:n,crumbs:a,headings:g,stepActive:h,setStepActive:m,handleSubmit:u,edit:i=!1,formValues:t,setFormValues:b=null})=>{const c=ne({mode:"onChange"}),[r,o]=k.useState(null),d=()=>{let v={};return document.globals.globals.find.customPostType.map(w=>{w.value!==null&&(v[w.label]={value:w.value,checked:c.getValues("post-types")?c.getValues("post-types").includes(w.value):!1})}),v};k.useEffect(()=>{t&&t[1]&&(o(t[1].icon),c.setValue("name",t[1].name),c.setValue("title",t[1].title),c.setValue("category",t[1].category),c.setValue("icon",t[1].icon),c.setValue("keywords",t[1].keywords),c.setValue("postTypes",t[1].postTypes))},[t]);const x=v=>{c.setValue("name",xs(v,32))},f=v=>{const N=v.length;if(N>50)return"Max block name length is 50";const w=v.match(/[a-z0-9_-]/g);return w===null||N!==w.length?"Allowed characters: [Lowercase alphanumeric characters, dashes, and underscores]":!0},R=async v=>{const N=v.length;if(N>50)return"Max block name length is 50";const w=v.match(/[a-z0-9_-]/g);return w===null||N!==w.length?"Allowed characters: [Lowercase alphanumeric characters, dashes, and underscores]":(await Re("checkBlockNameAction",{name:v})).exists===!0?v+" block already exists.":!0},E=async v=>i?f(v):R(v),j=async v=>{if(i)return;const N=le(ae(v));c.setValue("name",N),typeof await E(N)=="string"?c.setError("name",{message:s("Name is already taken")}):c.clearErrors("name")},C=v=>{u(v,1),i||m(1)},p=[e.jsx(L,{testId:"next-step",style:i?D.PRIMARY:D.SECONDARY,children:s(i?"Save":"Next Step")})];return e.jsx(ie,{...c,children:e.jsx("form",{onSubmit:c.handleSubmit(C),children:e.jsxs(ce,{crumbs:a,title:n,actions:p,children:[i&&e.jsx(J,{setFormValues:b,stepActive:h,setStepActive:m,steps:g}),e.jsxs(de,{style:"with-shadow",children:[!i&&e.jsx(oe,{stepActive:h,headings:g}),e.jsx(q,{label:s("Block label"),value:e.jsx(_,{id:"title",placeholder:s("Block label"),description:s("The block label"),register:c.register,errors:c.formState.errors,isRequired:!0,validate:{required:s("This field is mandatory")},onChangeCapture:je(v=>{j(v.target.value)},300)})}),e.jsx(q,{label:s("Block name"),value:e.jsx(_,{id:"name",readOnly:i,placeholder:s("Block name"),description:s("The block name/slug. Must be unique"),register:c.register,errors:c.formState.errors,isRequired:!0,onChangeCapture:v=>x(v.currentTarget.value),validate:{validate:{alphanumericallyValid:Ee,checkIfNameIsValid:E},required:s("This field is mandatory")}})}),e.jsx(Us,{}),e.jsx(Je,{icon:r}),e.jsx(q,{label:s("Keywords"),value:e.jsx(Qe,{register:c.register,id:"keywords",setValue:c.setValue,defaultValue:c.getValues("keywords")?c.getValues("keywords"):[],description:s("An array of search terms to help user discover the block while searching."),errors:c.formState.errors})}),e.jsx(q,{label:s("Post types"),value:e.jsx(Gs,{register:c.register,errors:c.formState.errors,id:"postTypes",values:d(),valueAsArray:!0})})]})]})})})};Ze.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(L).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,edit:l.bool};const De=({control:n})=>{const a=Y(),{selectedElements:g}=K(u=>u.blockControlsState),h=()=>g.filter(i=>i.id===n.id).length>0,m=u=>{a(He({control:n,selected:u}))};return e.jsx(U,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${n.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${n.id}`,type:"checkbox",checked:h(),onChange:u=>m(u.target.checked)}),e.jsx("span",{})]}),icon:!1,tip:s(h()?"Deselect this element":"Select this element")})};De.propTypes={control:l.object.isRequired};const es=({controlId:n,index:a})=>{const g=Y(),h=()=>`controls.${a}`,[m,u]=k.useState(!1),{control:i}=G(),{remove:t}=X({control:i,name:h()}),b=[e.jsx(L,{style:D.SUCCESS,onClick:c=>{c.preventDefault(),g(ze({controlId:n})),t(a),u(!m)},children:s("Yes")}),e.jsx(L,{style:D.DANGER,onClick:c=>{c.preventDefault(),u(!m)},children:s("No")})];return e.jsxs(z.Fragment,{children:[e.jsx(Ae,{title:s("Confirm deleting control"),visible:m,buttons:b,children:s("Are you sure?")}),e.jsx("a",{href:"#",onClick:c=>{c.preventDefault(),u(!m)},children:e.jsx(W,{icon:"bx-trash",width:18,color:"#F94144"})})]})};es.propTypes={controlId:l.string.isRequired,index:l.number.isRequired};const Le=({index:n,control:a})=>{const g=Y(),{closedElements:h}=K(o=>o.blockControlsState),{formState:{errors:m},control:u}=G(),i=H({formControl:u,name:`controls.${n}`}),{append:t}=X({formControl:u,name:"controls"}),b=()=>h.filter(d=>d===a.id).length===1,c=()=>{js(a.id),b()?g(vs({id:a.id})):g(ys({id:a.id}))},r=()=>{const o={...i};o.id=me(),o.label=o.label+" copy",o.name=o.name+"_copy",g(xe({control:o})),t(o),ks(1).then(()=>{_s(o.id)})};return e.jsxs("span",{className:"i-flex-center s-8",children:[e.jsx(U,{label:e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),r()},children:e.jsx(W,{icon:"bx:duplicate",width:18})}),tip:s("Duplicate this control"),icon:!1}),e.jsx(U,{label:e.jsx(es,{controlId:a.id,index:n}),tip:s("Delete this block control"),icon:!1}),e.jsx(U,{label:e.jsx("a",{href:"#",onClick:o=>{o.preventDefault(),c()},children:e.jsx(W,{icon:"bx:expand-alt",width:18})}),tip:s("Hide/show this block control"),icon:!1})]})};Le.propTypes={index:l.number.isRequired,control:l.object.isRequired};const Se=({controlId:n})=>{const a=Y(),[g,h]=k.useState(!1),[m,u]=k.useState(null),[i,t]=k.useState(null),[b,c]=k.useState(!1);k.useEffect(()=>{b&&(h(!0),Re("fetchDatasetsAction",{}).then(d=>{let x=[{value:null,label:s("Select"),items:[]}];d.records&&d.records.map(f=>{x.push({value:f.id,label:f.label?f.label:f.name,items:f.items?f.items:[]})}),u(x),h(!1)}).catch(d=>{console.error(d.message),h(!1)}))},[b]);const r=()=>{const d=m.filter(f=>f.value===i);if(d&&d.length!==1)return;d[0].items.map(f=>{const R={label:f.label,value:f.value,isDefault:f.isDefault};a(Ye({controlId:n,option:R}))}),Ce.success(s("Dataset loaded correctly")),c(!b)},o=[e.jsx(L,{style:D.PRIMARY,disabled:i===null,onClick:d=>{d.preventDefault(),r()},children:s("Load dataset")}),e.jsx(L,{style:D.DANGER,onClick:d=>{d.preventDefault(),c(!b)},children:s("Close")})];return e.jsxs(z.Fragment,{children:[e.jsx(Ae,{title:s("Load dataset"),visible:b,padding:0,buttons:o,children:g?e.jsx("div",{className:"p-24",children:s("Loading...")}):e.jsx("div",{className:"p-24",children:e.jsx("select",{id:"dataset",className:"form-control default",onChangeCapture:d=>t(d.target.value),children:m&&m.map(d=>e.jsx("option",{value:d.value,children:d.label}))})})}),e.jsx("a",{href:"#",onClick:d=>{d.preventDefault(),c(!b)},children:s("Load dataset")})]})};Se.propTypes={controlId:l.string.isRequired};const ss=({controlId:n,index:a,optionIndex:g})=>{const h=Y(),m=()=>`controls.${a}.options`,[u,i]=k.useState(!1),{control:t}=G(),{remove:b}=X({control:t,name:m()}),c=[e.jsx(L,{style:D.SUCCESS,onClick:r=>{r.preventDefault(),h(Cs({controlId:n,optionIndex:g})),b(g),i(!u)},children:s("Yes")}),e.jsx(L,{style:D.DANGER,onClick:r=>{r.preventDefault(),i(!u)},children:s("No")})];return e.jsxs("span",{children:[e.jsx(Ae,{title:s("Confirm deleting option"),visible:u,buttons:c,children:s("Are you sure?")}),e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),i(!u)},children:e.jsx(U,{icon:!1,tip:s("Delete"),label:e.jsx(W,{icon:"bx-trash",width:18,color:"#F94144"})})})]})};ss.propTypes={controlId:l.string.isRequired,index:l.number.isRequired,optionIndex:l.number.isRequired};const ts=({index:n,controlId:a,optionIndex:g,option:h,handleIsDefault:m})=>{const u=T=>`controls.${n}.options.${g}.${T}`,{register:i,formState:{errors:t},control:b,setValue:c,resetField:r}=G(),o=H({control:b,name:u("value")}),d=H({control:b,name:u("label")}),x=H({control:b,name:u("isDefault")}),{attributes:f,listeners:R,setNodeRef:E,isDragging:j,transform:C}=qe({id:`${a}.options.${g}`}),p={transform:Ie.Translate.toString(C)},v=()=>h.label==="label"&&h.value==="value"?!0:h.label===h.value,[N,w]=k.useState(v()),y=()=>o||(h.value?h.value:null),O=()=>d||(h.label?h.label:null);return e.jsx(z.Fragment,{children:e.jsxs("tr",{style:p,ref:E,className:`bg-white ${j?"b-rounded z-100 with-drop-shadow":""}`,children:[e.jsx("td",{children:e.jsx("span",{className:"cursor-move top-2 handle",...f,...R,children:e.jsx(W,{icon:"bx:dots-vertical-rounded",color:be(),width:18})})}),e.jsx("td",{children:e.jsx(_,{id:u("label"),register:i,errors:t,defaultValue:O(),onChangeCapture:T=>{N&&c(u("value"),T.target.value)},onClick:T=>{h.label&&T.target.value==="label"&&r(u("label"))},validate:{required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsx(_,{id:u("value"),register:i,errors:t,defaultValue:y(),onChangeCapture:T=>{N&&c(u("label"),T.target.value)},onClick:T=>{h.value&&T.target.value==="value"&&r(u("value"))},validate:{required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("td",{children:e.jsxs("span",{className:"i-flex-center s-8",children:[e.jsx(U,{label:e.jsx("button",{type:"button",className:`acpt-btn-switch ${N?"active":""}`,onClick:T=>{T.preventDefault(),w(!N)},children:e.jsx(W,{icon:"bx:bx-link",width:"18px"})}),tip:s(N?"Label and value are linked":"Label and value are unlinked"),icon:!1}),e.jsx(U,{label:e.jsx(Vs,{control:b,defaultValue:typeof x=="boolean"?x:h.isDefault,errors:t,icon:"bx:check",id:u("isDefault"),externalOnChange:m}),tip:s("Default value"),icon:!1})]})}),e.jsx("td",{children:e.jsx(ss,{controlId:a,index:n,optionIndex:g})})]})})};ts.propTypes={controlId:l.string.isRequired,index:l.number.isRequired,optionIndex:l.number.isRequired,option:l.object.isRequired,handleIsDefault:l.func};const rs=({index:n,controlId:a,options:g,isMulti:h=!1})=>{const m=document.globals;m.settings;const u=m.globals,i=Y(),[t]=Te(),{setValue:b,control:c}=G(),r=()=>`controls.${n}.options`,{move:o}=X({formControl:c,name:r()}),d=R=>{const{active:E,over:j}=R;if(E.id===j.id)return;const C=g.findIndex(N=>N.id===E.id),p=g.findIndex(N=>N.id===j.id),v=Ve(g,C,p);o(C,p),i(Ss({controlId:a,sortedOptions:v}))},x=()=>{i(Ye({controlId:a,option:{label:"label",value:"value",isDefault:!1}}))},f=({id:R,checked:E})=>{if(!h)for(let j=0;j<g.length;j++){const C=r()+"."+j+".isDefault";C!==R?b(C,!1):b(C,E)}};return e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:s("Options")}),g&&g.length>0?e.jsxs("div",{className:"responsive with-shadow b-rounded",children:[e.jsxs("table",{className:`acpt-table ${u.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10px"}}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Value")}),e.jsx("th",{style:{width:"10px"}}),e.jsx("th",{style:{width:"10px"}})]})}),e.jsx("tbody",{ref:t,children:e.jsx(We,{onDragEnd:d,items:g,children:g&&g.map((R,E)=>e.jsx(ts,{controlId:a,index:n,optionIndex:E,option:R,handleIsDefault:f}))})})]}),e.jsxs("div",{className:"p-24 i-flex-center s-8",children:[e.jsx("a",{href:"#",onClick:R=>{R.preventDefault(),x()},children:s("Add option")}),e.jsx(Se,{controlId:a})]})]}):e.jsxs("div",{className:"mt-8 b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s('No options already created. Create the first one now by clicking the button "Add option"!')}),e.jsxs("div",{className:"bg-white i-flex-center justify-center s-8",children:[e.jsx("a",{href:"#",onClick:R=>{R.preventDefault(),x()},children:s("Add option")}),e.jsx(Se,{controlId:a})]})]})]})};rs.propTypes={index:l.number.isRequired,controlId:l.string.isRequired,options:l.array.isRequired,isMulti:l.bool};const ls=({index:n,control:a})=>{const{attributes:g,listeners:h,setNodeRef:m,isDragging:u,transform:i}=qe({id:a.id}),t={transform:Ie.Translate.toString(i)},b=Y(),[c,r]=k.useState(!0),{formState:{errors:o},register:d,unregister:x,setValue:f,clearErrors:R,setError:E,resetField:j,control:C}=G(),p=S=>`controls.${n}.${S}`,v=H({formControl:C,name:"controls"}),N=H({formControl:C,name:p("name")}),w=H({formControl:C,name:p("label")}),y=H({formControl:C,name:p("type")}),O=()=>{const S=p("name"),F=fe(o,S);return F?e.jsx("span",{className:"invalid-feedback",children:s(F.message)}):N||a.name},T=()=>typeof w=="string"?w:a.label,P=()=>y||a.type,Q=S=>{if(P()!==S){const F={...a};F.type=S,ee(P())||(F.options=[],x(p("options"))),F.default=null,F.settings=[],x(p("settings")),x(p("default")),F.options||(F.options=[]),F.settings||(F.settings=[]),F.default||(F.default=null),b(Ge({control:F}))}},ue=async S=>{if(c){const F=le(ae(S));f(p("name"),F),await Z(F)?E(p("name"),{message:s("Name is already taken")}):R(p("name"))}},Z=async S=>{const F=le(ae(S));let ge=[];if(v&&v.map((te,ve)=>{ve!==n&&ge.push(te.name)}),ge.includes(F))return s("Name is already taken")},ee=S=>S===$.SELECT||S===$.SELECT_MULTI||S===$.RADIO,M=S=>S===$.RADIO||S===$.TEXT||S===$.EMAIL||S===$.PHONE||S===$.TEXTAREA,pe=S=>S===$.CHECKBOX||S===$.TOGGLE,se=S=>S===$.NUMBER||S===$.RANGE,he=S=>S===$.TEXTAREA;return e.jsxs(z.Fragment,{children:[e.jsx(Ke,{id:p("id"),value:a.id,register:d}),e.jsx("tr",{id:a.id,ref:m,style:t,className:`bg-white ${u?"b-rounded z-100 with-drop-shadow":""}`,children:e.jsxs("td",{style:{background:Ns()},className:"with-active-border",colSpan:5,children:[e.jsx("div",{children:e.jsxs("div",{className:"flex-between s-8 mb-24 for-xs",children:[e.jsxs("span",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...g,...h,children:e.jsx(W,{icon:"bx:dots-vertical-rounded",color:be(),width:18})}),e.jsx(De,{control:a}),e.jsxs("div",{className:"i-flex-center s-8 text-ellipsis",children:[e.jsx("h3",{children:O()}),e.jsx("span",{className:"color-gray",children:T()}),e.jsx(Ue,{fieldType:P(),css:"with-border b-rounded p-8"})]})]}),e.jsx(Le,{index:n,control:a})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{className:"container align-end",children:[e.jsxs("div",{className:"col-4",children:[e.jsx(V,{isRequired:!1,id:p("label"),label:e.jsxs("div",{className:"flex-between",children:[e.jsx("span",{children:s("Control label")}),e.jsx("a",{href:"#",style:{fontWeight:"normal"},onClick:S=>{S.preventDefault(),r(!c)},children:s(`${c?"Auto slug ON":"Auto slug OFF"}`)})]})}),e.jsx(_,{id:p("label"),register:d,errors:o,defaultValue:a.label,placeholder:s("The field label, non latin characters are allowed"),onChangeCapture:je(S=>{ue(S.target.value)},300),onClick:S=>{S.target.value==="Block control"&&j(p("label"))},validate:{maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx(V,{isRequired:!0,id:p("name"),label:s("Control slug")}),e.jsx(_,{id:p("name"),register:d,errors:o,placeholder:s("Control slug (Ex. gallery or text_1)"),defaultValue:a.name,onClick:S=>{S.target.value==="block-control"&&j(p("name"))},validate:{validate:{alphanumericallyValid:Ee,checkIfNameIsValid:Z},required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx(V,{isRequired:!0,id:p("type"),label:s("Choose the control type")}),e.jsx(we,{register:d,id:p("type"),errors:o,defaultValue:a.type,values:Pe(),onChangeCapture:S=>{Q(S.target.value)}})]})]}),e.jsx("div",{className:"container align-end",children:e.jsxs("div",{className:"col-12",children:[e.jsx(V,{id:p("description"),label:s("The description of this control (showed only on admin panel)")}),e.jsx(Ys,{id:p("description"),register:d,defaultValue:a.description?a.description:"",errors:o,placeholder:s("A brief description"),characterLimit:255,rows:4,validate:{maxLength:{value:255,message:"max length is 255"}}})]})}),se(P())&&e.jsx("div",{className:"container align-end",children:e.jsxs("div",{className:"col-12",children:[e.jsx(V,{isRequired:!1,id:p("default"),label:s("Default value")}),e.jsx(_,{type:"number",id:p("default"),register:d,errors:o,placeholder:s("Default value"),defaultValue:a.default})]})}),pe(P())&&e.jsx("div",{className:"container align-end",children:e.jsxs("div",{className:"col-12",children:[e.jsx(V,{isRequired:!1,id:p("default"),label:s("Default value")}),e.jsx(A,{register:d,id:p("default"),errors:o,defaultValue:a.default})]})}),M(P())&&e.jsx("div",{className:"container align-end",children:e.jsxs("div",{className:"col-12",children:[e.jsx(V,{isRequired:!1,id:p("default"),label:s("Default value")}),e.jsx(_,{id:p("default"),type:P()===$.EMAIL?"email":"text",register:d,errors:o,placeholder:s("Default value"),defaultValue:a.default})]})}),ee(P())&&e.jsx(rs,{options:a.options?a.options:[],index:n,controlId:a.id,isMulti:y===$.SELECT_MULTI}),se(P())&&e.jsxs("div",{className:"container align-end",children:[e.jsxs("div",{className:"col-4",children:[e.jsx(V,{isRequired:!1,id:p("settings.min"),label:s("Min")}),e.jsx(_,{type:"number",id:p("settings.min"),register:d,errors:o,placeholder:s("Min value"),defaultValue:a.settings.min})]}),e.jsxs("div",{className:"col-4",children:[e.jsx(V,{isRequired:!1,id:p("settings.max"),label:s("Max")}),e.jsx(_,{type:"number",id:p("settings.max"),register:d,errors:o,placeholder:s("Max value"),defaultValue:a.settings.max})]}),e.jsxs("div",{className:"col-4",children:[e.jsx(V,{isRequired:!1,id:p("settings.step"),label:s("Step")}),e.jsx(_,{type:"number",id:p("settings.step"),register:d,errors:o,placeholder:s("Step value"),defaultValue:a.settings.step})]})]}),he(P())&&e.jsx("div",{className:"container align-end",children:e.jsxs("div",{className:"col-12",children:[e.jsx(V,{isRequired:!1,id:p("settings.rows"),label:s("Rows")}),e.jsx(_,{type:"number",id:p("settings.rows"),register:d,errors:o,placeholder:s("Rows value"),defaultValue:a.settings.step})]})})]})})]})})]})};ls.propTypes={index:l.number.isRequired,control:l.object.isRequired};const Ne=({index:n,control:a,bulkEdit:g=!1})=>{const{attributes:h,listeners:m,setNodeRef:u,isDragging:i,transform:t}=qe({id:a.id}),b={transform:Ie.Translate.toString(t)},c=Y(),{formState:{errors:r},register:o,unregister:d,clearErrors:x,setValue:f,setError:R,resetField:E,control:j}=G(),[C,p]=k.useState(!0),[v,N]=k.useState(!1),[w,y]=k.useState(!1),[O,T]=k.useState(!1),[P,Q]=k.useState(!1),ue=k.useRef(),Z=k.useRef(),ee=k.useRef();Me([ue],()=>{y(!1)}),Me([Z,ee],()=>{N(!1),T(!1),Q(!1)});const M=I=>`controls.${n}.${I}`,pe=H({formControl:j,name:"controls"}),se=H({formControl:j,name:M("name")}),he=H({formControl:j,name:M("label")}),S=H({formControl:j,name:M("type")}),F=()=>{const I=M("name"),B=fe(r,I);return B?e.jsx("span",{className:"invalid-feedback",children:s(B.message)}):se||a.name},ge=()=>typeof he=="string"?he:a.label,te=()=>S||a.type,ve=I=>I===$.SELECT||I===$.SELECT_MULTI||I===$.RADIO,ps=I=>{if(te()!==I){const B={...a};B.type=I,ve(te())||(B.options=[],d(M("options"))),B.default=null,B.settings=[],d(M("settings")),d(M("default")),B.options||(B.options=[]),B.settings||(B.settings=[]),B.default||(B.default=null),c(Ge({control:B}))}},Oe=async I=>{const B=le(ae(I));let Fe=[];if(pe&&pe.map((gs,ms)=>{ms!==n&&Fe.push(gs.name)}),Fe.includes(B))return s("Name is already taken")},hs=async I=>{if(C){const B=le(ae(I));f(M("name"),B),await Oe(B)?R(M("name"),{message:s("Name is already taken")}):x(M("name"))}};return e.jsxs(z.Fragment,{children:[e.jsx(Ke,{id:M("id"),value:a.id,register:o}),e.jsxs("tr",{id:a.id,ref:u,style:b,className:`bg-white b-rounded ${i?"z-100 with-drop-shadow":""}`,children:[e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move handle top-2",...h,...m,children:e.jsx(W,{icon:"bx:dots-vertical-rounded",color:be(),width:18})}),e.jsx(De,{control:a})]})}),e.jsx("td",{className:"hidden-xs",children:v||g?e.jsxs("div",{ref:Z,className:"w-100 i-flex-center s-8",children:[e.jsx(_,{id:M("label"),register:o,errors:r,autoFocus:O,defaultValue:a.label,placeholder:s("The field label, non latin characters are allowed"),onChangeCapture:je(I=>{hs(I.target.value)},300),onClick:I=>{I.target.value==="Block control"&&E(M("label"))},validate:{maxLength:{value:255,message:"max length is 255"}}}),e.jsx(U,{label:e.jsx("span",{className:`acpt-btn-switch ${C===!0?"active":""}`,onClick:I=>{I.preventDefault(),p(!C)},children:e.jsx(W,{icon:"bx-link",width:18})}),tip:s(`${C?"Auto slug ON":"Auto slug OFF"}`),icon:!1})]}):e.jsx("div",{className:"cursor-pointer",onClick:()=>{window.innerWidth>=960&&(N(!v),T(!O),Q(!1))},children:ge()})}),e.jsx("td",{children:v||g?e.jsx("div",{ref:ee,children:e.jsx(_,{id:M("name"),register:o,errors:r,autoFocus:P,placeholder:s("Field slug (Ex. gallery or text_1)"),defaultValue:a.name,onClick:I=>{I.target.value==="block-control"&&E(M("name"))},validate:{validate:{alphanumericallyValid:Ee,checkIfNameIsValid:Oe},required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}):e.jsx("div",{className:"text-bold color-black cursor-pointer",onClick:()=>{window.innerWidth>=960&&(N(!v),Q(!P),T(!1))},children:F()})}),e.jsx("td",{children:w||g?e.jsx("div",{ref:ue,style:{maxWidth:"200px"},children:e.jsx(we,{register:o,id:M("type"),errors:r,defaultValue:a.type,values:Pe(),onChangeCapture:I=>{ps(I.target.value)}})}):e.jsx("div",{className:"i-flex-center s-8 cursor-pointer",onClick:()=>{window.innerWidth>=960&&y(!w)},children:e.jsx(Ue,{fieldType:te(),css:"with-border b-rounded p-8"})})}),e.jsx("td",{children:e.jsx(Le,{control:a,index:n})})]})]})};Ne.propTypes={index:l.number.isRequired,control:l.object.isRequired,bulkEdit:l.bool};const as=({index:n,control:a,bulkEdit:g=!1})=>{const{closedElements:h}=K(u=>u.blockControlsState),m=()=>{const u=h.filter(i=>i===a.id);return typeof u>"u"?!1:u.length>0};return g?e.jsx(Ne,{bulkEdit:g,index:n,control:a}):m()?e.jsx(Ne,{bulkEdit:g,index:n,control:a}):e.jsx(ls,{index:n,control:a})};as.propTypes={index:l.number.isRequired,control:l.object.isRequired,bulkEdit:l.bool};const os=({bulkEdit:n=!1})=>{const a=document.globals;a.settings;const g=a.globals,h=Y(),{controls:m,areAllElementsSelected:u}=K(x=>x.blockControlsState),[i,t]=Te(),{control:b}=G(),{move:c}=X({formControl:b,name:"controls"}),r=()=>{const f={id:me(),name:"block-control",label:"Block control",type:"Text",description:"",options:[],settings:[],default:null};h(xe({control:f}))},o=x=>{const{active:f,over:R}=x;if(f.id===R.id)return;const E=m.findIndex(p=>p.id===f.id),j=m.findIndex(p=>p.id===R.id),C=Ve(m,E,j);c(E,j),h(Rs({controls:C}))},d=x=>{m&&m.map(f=>{h(He({control:f,selected:x}))})};return e.jsxs("div",{ref:t,className:"flex-column s-24",children:[e.jsx("div",{className:"responsive",children:e.jsxs("table",{className:`acpt-table  ${g.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"10px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"select-all",style:{marginLeft:"26px"},children:[e.jsx("input",{id:"select-all",type:"checkbox",checked:u,onChange:x=>{d(x.target.checked)}}),e.jsx("span",{})]})}),e.jsx("th",{style:{width:"25%"},className:"hidden-xs",children:s("Label")}),e.jsx("th",{style:{width:"25%"},children:s("Name")}),e.jsx("th",{style:{width:"25%"},children:s("Type")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{ref:i,children:e.jsx(We,{onDragEnd:o,items:m,children:e.jsx(z.Fragment,{children:m&&m.map((x,f)=>e.jsx(as,{bulkEdit:n,index:f,control:x},x.id))})})})]})}),e.jsx("div",{className:"pt-0 p-24",children:e.jsx(L,{type:"button",style:D.WHITE,onClick:()=>{r()},children:s("Add control")})})]})};os.propTypes={bulkEdit:l.bool};const ns=()=>{const n=Y(),{selectedElements:a}=K(r=>r.blockControlsState),{control:g,getValues:h,setValue:m}=G(),{append:u}=X({control:g,name:"controls"}),i=k.useRef(null),[t,b]=k.useState(null),c=()=>{a.map(r=>{switch(t){case"duplicate":const o={...r};o.id=me(),o.label=o.label+" copy",o.name=o.name+"_copy",n(xe({control:o})),u(o);break;case"delete":const d=h("controls"),x=d?d.filter(f=>f.id!==r.id):[];typeof d<"u"&&(m("controls",x),n(ze({controlId:r.id})));break}}),(t==="delete"||t==="duplicate")&&n(ws()),i.current.value=""};return e.jsx(z.Fragment,{children:a&&a.length>0&&e.jsxs("div",{className:"pt-0 p-24 flex-between",children:[e.jsxs("div",{children:[a.length," ",s("Selected items")]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:i,className:"form-control sm",onChange:r=>{b(r.target.value!==""?r.target.value:null)},children:[e.jsx("option",{value:"",children:s("Select")}),e.jsx("option",{value:"duplicate",children:s("Duplicate")}),e.jsx("option",{value:"delete",children:s("Delete")})]}),e.jsx(L,{style:D.WHITE,size:"sm",disabled:t===null,onClick:r=>{r.preventDefault(),c()},children:s("Execute")})]})]})})};ns.propTypes={setBoxTab:l.func,setFieldTab:l.func,setBlockTab:l.func};const is=({title:n,crumbs:a,headings:g,stepActive:h,setStepActive:m,handleSubmit:u,edit:i=!1,formValues:t,setFormValues:b=null})=>{const c=Y(),{controls:r,closedElements:o}=K(y=>y.blockControlsState),d=()=>{const O={id:me(),name:"block-control",label:"Block control",type:"Text",description:"",options:[],settings:[],default:null};c(xe({control:O}))},{id:x}=ye(),[f,R]=k.useState(!1);k.useEffect(()=>{ke(s(n)),Es("#/blocks"),x||c(Be({controls:[]})),x&&R(Ts(x))},[x]),k.useEffect(()=>{if(t[3]&&t[3].controls){const y=t[3].controls;y.map((O,T)=>{j.setValue(`controls.${T}.id`,O.id),j.setValue(`controls.${T}.name`,O.name),j.setValue(`controls.${T}.label`,O.label),j.setValue(`controls.${T}.type`,O.type),j.setValue(`controls.${T}.description`,O.description),j.setValue(`controls.${T}.options`,O.options),j.setValue(`controls.${T}.settings`,O.settings),j.setValue(`controls.${T}.default`,O.default)}),c(Be({controls:y}))}},[t]);const[E]=Te(),j=ne({mode:"onChange"}),C=()=>{let y=[];r.map(O=>{y.push(O.id)}),o.length>0?(c(qs()),Is(y)):(c(As()),Ds(y))},p=()=>{let y=[];return r.map(O=>{Ls(O.id)&&y.push(O.id)}),y.length===r.length},v=y=>{x&&Os(x,y),R(!f)},N=y=>{u(y,3),i||m(3)};let w=[];return i||w.push(e.jsx(L,{testId:"prev-step",type:"button",onClick:()=>m(2),style:D.SECONDARY,children:s("Previous Step")})),w.push(e.jsx(L,{testId:"next-step",style:i?D.PRIMARY:D.SECONDARY,children:s(i?"Save":"Next Step")})),e.jsx(ie,{...j,children:e.jsx("form",{onSubmit:j.handleSubmit(N),children:e.jsxs(ce,{crumbs:a,title:n,actions:w,children:[i&&e.jsx(J,{setFormValues:b,stepActive:h,setStepActive:m,steps:g}),e.jsxs(de,{style:"with-shadow",children:[!i&&e.jsx(oe,{stepActive:h,headings:g}),e.jsxs("div",{className:"",ref:E,children:[e.jsxs("div",{className:"p-24 flex-between s-8",children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("h3",{children:s("Block controls")}),e.jsx("span",{className:"px-8 py-4 font-sm bg-light-gray text-normal b-rounded",children:r&&r.length>0?r.length:0})]}),e.jsx(Ps,{name:"meta-field-menu",buttonClass:D.SECONDARY,anchor:e.jsx(W,{icon:"bx:dots-vertical-rounded",color:be(),width:24}),links:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{htmlFor:"toggle_visibility",className:"toggle",children:[e.jsx("input",{id:"toggle_visibility",type:"checkbox",checked:p(),onChangeCapture:y=>{C()}}),e.jsx("span",{className:"slider round"})]})}),e.jsx("label",{className:"cursor-pointer",htmlFor:"toggle_visibility",children:s("Hide elements")})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{htmlFor:"toggle_bulk_edit",className:"toggle",children:[e.jsx("input",{id:"toggle_bulk_edit",type:"checkbox",checked:f,onChangeCapture:y=>{v(y.target.checked)}}),e.jsx("span",{className:"slider round"})]})}),e.jsx("label",{className:"cursor-pointer",htmlFor:"toggle_bulk_edit",children:s("Bulk edit")})]})]})]}),e.jsx(ns,{}),r&&r.length>0?e.jsx(os,{bulkEdit:f}):e.jsx("div",{className:"p-24 pt-0",children:e.jsxs("div",{className:"b-maxi b-rounded p-24 flex-column s-12 text-center",children:[e.jsx("span",{children:s('No block controls already created. Create the first one now by clicking the button "Add control"!')}),e.jsx("div",{children:e.jsx(L,{type:"button",style:D.SECONDARY,onClick:()=>{d()},children:s("Add control")})})]})})]})]})]})})})};is.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(L).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,edit:l.bool};const cs=({title:n,crumbs:a,headings:g,stepActive:h,setStepActive:m,handleSubmit:u,edit:i=!1,formValues:t,setFormValues:b=null,loading:c=!1})=>{const r=ne({mode:"onChange"});let o=[];i||o.push(e.jsx(L,{testId:"prev-step",type:"button",onClick:()=>m(3),style:D.SECONDARY,children:s("Previous Step")})),o.push(e.jsx(L,{testId:"next-step",style:D.PRIMARY,disabled:c===!0,children:s("Save")}));const[d,x]=k.useState(null);k.useEffect(()=>{t&&t[5]&&(x(t[5].css),r.setValue("css",t[5].css))},[t]);const f=R=>{u(R,5)};return e.jsx(ie,{...r,children:e.jsx("form",{onSubmit:r.handleSubmit(f),children:e.jsxs(ce,{crumbs:a,title:n,actions:o,children:[i&&e.jsx(J,{setFormValues:b,stepActive:h,setStepActive:m,steps:g}),e.jsxs(de,{style:"with-shadow",children:[!i&&e.jsx(oe,{stepActive:h,headings:g}),e.jsx(q,{label:s("Block CSS"),wizard:s("Enter the CSS that will be used on the block here."),value:e.jsx(Xe,{theme:"vs-dark",height:"500px",language:"css",options:{selectOnLineNumbers:!0},value:d,onChange:(R,E)=>{r.setValue("css",R)}})})]})]})})})};cs.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(L).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,edit:l.bool,loading:l.bool};const ds=({title:n,crumbs:a,headings:g,stepActive:h,setStepActive:m,handleSubmit:u,edit:i=!1,formValues:t,setFormValues:b=null})=>{const c=ne({mode:"onChange"}),r=fe(c.formState.errors,"callback"),o=()=>typeof r<"u";let d=[];i||d.push(e.jsx(L,{testId:"prev-step",type:"button",onClick:()=>m(2),style:D.SECONDARY,children:s("Previous Step")})),d.push(e.jsx(L,{disabled:o(),testId:"next-step",style:i?D.PRIMARY:D.SECONDARY,children:s(i?"Save":"Next Step")}));const[x,f]=k.useState(null),R=j=>{Re("checkTwigCodeAction",{string:j}).then(C=>{C.error&&C.success===!1?c.setError("callback",{message:C.error}):c.clearErrors("callback")}).catch(C=>{console.error(C),setLoading(!1)})};k.useEffect(()=>{t&&t[4]&&(f(t[4].callback),c.setValue("callback",t[4].callback))},[t]);const E=j=>{u(j,4),i||m(4)};return e.jsx(ie,{...c,children:e.jsx("form",{onSubmit:c.handleSubmit(E),children:e.jsxs(ce,{crumbs:a,title:n,actions:d,children:[i&&e.jsx(J,{setFormValues:b,stepActive:h,setStepActive:m,steps:g}),e.jsxs(de,{style:"with-shadow",children:[!i&&e.jsx(oe,{stepActive:h,headings:g}),e.jsx(q,{label:s("Block callback"),wizard:s("This is the block's code that will be run. Make use of TWIG syntax."),value:e.jsxs(z.Fragment,{children:[r&&e.jsx("div",{className:"invalid-feedback mb-24",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:r.message}})}),e.jsx(Xe,{theme:"vs-dark",height:"500px",language:"html",options:{selectOnLineNumbers:!0},value:x,onMount:(j,C)=>{const p=v=>{let N=[];t[3]&&t[3].controls&&t[3].controls.map(y=>{N.push({documentation:y.name,insertText:y.name,kind:C.languages.CompletionItemKind.Keyword,label:y.name,range:v})});const w=document.globals.globals.find.fields;return w&&w.map(y=>{y.value!==null&&N.push({documentation:y.label,insertText:"acpt_"+y.label,kind:C.languages.CompletionItemKind.Keyword,label:y.label,range:v})}),N};C.languages.registerCompletionItemProvider("html",{provideCompletionItems:function(v,N){const w=v.getWordUntilPosition(N),y={startLineNumber:N.lineNumber,endLineNumber:N.lineNumber,startColumn:w.startColumn,endColumn:w.endColumn};return{suggestions:p(y)}}})},onChange:je((j,C)=>{R(j),c.setValue("callback",j)},1e3)})]})})]})]})})})};ds.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(L).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,edit:l.bool};const us=({title:n,crumbs:a,headings:g,stepActive:h,setStepActive:m,handleSubmit:u,edit:i=!1,formValues:t,setFormValues:b=null,loading:c=!1})=>{const r=ne({mode:"onChange"});let o=[];i||o.push(e.jsx(L,{testId:"prev-step",type:"button",onClick:()=>m(1),style:D.SECONDARY,children:s("Previous Step")})),o.push(e.jsx(L,{testId:"next-step",style:i?D.PRIMARY:D.SECONDARY,children:s(i?"Save":"Next Step")})),k.useEffect(()=>{t&&t[2]&&(r.setValue("supports.anchor",t[2].supports?t[2].supports.anchor:!1),r.setValue("supports.align",t[2].supports?t[2].supports.align:[]),r.setValue("supports.alignWide",t[2].supports?t[2].supports.alignWide:!1),r.setValue("supports.background.backgroundImage",t[2].supports&&t[2].supports.background?t[2].supports.background.backgroundImage:!1),r.setValue("supports.background.backgroundSize",t[2].supports&&t[2].supports.background?t[2].supports.background.backgroundSize:!1),r.setValue("supports.color.background",t[2].supports&&t[2].supports.color?t[2].supports.color.background:!0),r.setValue("supports.color.button",t[2].supports&&t[2].supports.color?t[2].supports.color.button:!1),r.setValue("supports.color.enableContrastChecker",t[2].supports&&t[2].supports.color?t[2].supports.color.enableContrastChecker:!0),r.setValue("supports.color.gradients",t[2].supports&&t[2].supports.color?t[2].supports.color.gradients:!1),r.setValue("supports.color.heading",t[2].supports&&t[2].supports.color?t[2].supports.color.heading:!1),r.setValue("supports.color.link",t[2].supports&&t[2].supports.color?t[2].supports.color.link:!1),r.setValue("supports.color.text",t[2].supports&&t[2].supports.color?t[2].supports.color.text:!0),r.setValue("supports.dimensions.aspectRatio",t[2].supports&&t[2].supports.dimensions?t[2].supports.dimensions.aspectRatio:!1),r.setValue("supports.dimensions.minHeight",t[2].supports&&t[2].supports.dimensions?t[2].supports.dimensions.minHeight:!1),r.setValue("supports.filter.duotone",t[2].supports?t[2].supports.filter.duotone:!1),r.setValue("supports.html",t[2].supports?t[2].supports.html:!0),r.setValue("supports.lock",t[2].supports?t[2].supports.lock:!1),r.setValue("supports.multiple",t[2].supports?t[2].supports.multiple:!0),r.setValue("supports.position.sticky",t[2].supports?t[2].supports.position.sticky:!1),r.setValue("supports.renaming",t[2].supports?t[2].supports.renaming:!0),r.setValue("supports.reusable",t[2].supports?t[2].supports.reusable:!0),r.setValue("supports.shadow",t[2].supports?t[2].supports.shadow:!1),r.setValue("supports.spacing.margin",t[2].supports&&t[2].supports.spacing?t[2].supports.spacing.margin:[]),r.setValue("supports.spacing.padding",t[2].supports&&t[2].supports.spacing?t[2].supports.spacing.padding:[]),r.setValue("supports.spacing.blockGap",t[2].supports&&t[2].supports.spacing?t[2].supports.spacing.blockGap:[]),r.setValue("supports.typography.fontSize",t[2].supports&&t[2].supports.typography?t[2].supports.typography.fontSize:!1),r.setValue("supports.typography.lineHeight",t[2].supports&&t[2].supports.typography?t[2].supports.typography.lineHeight:!1),r.setValue("supports.typography.textAlign",t[2].supports&&t[2].supports.typography?t[2].supports.typography.textAlign:[]))},[t]);const d=x=>{u(x,2),i||m(2)};return e.jsx(ie,{...r,children:e.jsx("form",{onSubmit:r.handleSubmit(d),children:e.jsxs(ce,{crumbs:a,title:n,actions:o,children:[i&&e.jsx(J,{setFormValues:b,stepActive:h,setStepActive:m,steps:g}),e.jsxs(de,{style:"with-shadow",children:[!i&&e.jsx(oe,{stepActive:h,headings:g}),e.jsx(q,{label:s("Anchor"),value:e.jsx(A,{id:"supports.anchor",register:r.register,errors:r.formState.errors,description:s("Anchors let you link directly to a specific block on a page.")})}),e.jsx(q,{label:s("Align"),value:e.jsx(z.Fragment,{children:e.jsx(re,{id:"supports.align",register:r.register,errors:r.formState.errors,description:s("This property adds block controls."),clearErrors:r.clearErrors,setValue:r.setValue,defaultValue:t[2]&&t[2].supports?t[2].supports.align:[],values:[{label:s("Left"),value:"left"},{label:s("Center"),value:"center"},{label:s("Right"),value:"right"},{label:s("Wide"),value:"wide"},{label:s("Full"),value:"full"}]})})}),e.jsx(q,{label:s("Align wide"),value:e.jsx(A,{id:"supports.alignWide",register:r.register,errors:r.formState.errors,description:s("This property allows to enable wide alignment for your theme.")})}),e.jsx(q,{label:s("Background"),value:e.jsxs("div",{className:"flex-column s-12",children:[e.jsx(A,{id:"supports.background.backgroundImage",register:r.register,errors:r.formState.errors,description:s("Enable background image control.")}),e.jsx(A,{id:"supports.background.backgroundSize",register:r.register,errors:r.formState.errors,description:s("Enable/disable background image + size control.")})]})}),e.jsx(q,{label:s("Color"),value:e.jsxs("div",{className:"flex-column s-12",children:[e.jsx(A,{id:"supports.color.background",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Enable/disable background and text color support.")}),e.jsx(A,{id:"supports.color.button",register:r.register,errors:r.formState.errors,description:s("Enable/disable button color support.")}),e.jsx(A,{id:"supports.color.enableContrastChecker",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Enable/disable contrast checker widget in the block editor UI..")}),e.jsx(A,{id:"supports.color.gradients",register:r.register,errors:r.formState.errors,description:s("Enable/disable gradient backgrounds support.")}),e.jsx(A,{id:"supports.color.heading",register:r.register,errors:r.formState.errors,description:s("Enable/disable heading color support.")}),e.jsx(A,{id:"supports.color.link",register:r.register,errors:r.formState.errors,description:s("Enable/disable link colors control.")}),e.jsx(A,{id:"supports.color.text",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Enable/disable background and text, but not link.")})]})}),e.jsx(q,{label:s("Dimensions"),value:e.jsxs("div",{className:"flex-column s-12",children:[e.jsx(A,{id:"supports.dimensions.aspectRatio",register:r.register,errors:r.formState.errors,description:s("Enable/disable aspect ratio control.")}),e.jsx(A,{id:"supports.dimensions.minHeight",register:r.register,errors:r.formState.errors,description:s("Enable/disable min height control.")})]})}),e.jsx(q,{label:s("Filter"),value:e.jsx(A,{id:"supports.filter.duotone",register:r.register,errors:r.formState.errors,description:s("Enable/disable duotone support.")})}),e.jsx(q,{label:s("HTML"),value:e.jsx(A,{id:"supports.html",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Enable/disable support for an HTML mode.")})}),e.jsx(q,{label:s("Lock"),value:e.jsx(A,{id:"supports.lock",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Enable/disable the ability to toggle the lock state.")})}),e.jsx(q,{label:s("Multiple"),value:e.jsx(A,{id:"supports.multiple",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Determine if a block can be used multiple times.")})}),e.jsx(q,{label:s("Position"),value:e.jsx(A,{id:"supports.position.sticky",register:r.register,errors:r.formState.errors,description:s("Enable/disable selecting sticky position.")})}),e.jsx(q,{label:s("Renaming"),value:e.jsx(A,{id:"supports.renaming",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Determine if a block can be renamed in the editor.")})}),e.jsx(q,{label:s("Reusable"),value:e.jsx(A,{id:"supports.reusable",defaultValue:!0,register:r.register,errors:r.formState.errors,description:s("Enable/disable the ability of being converted into a reusable block.")})}),e.jsx(q,{label:s("Shadow"),value:e.jsx(A,{id:"supports.shadow",register:r.register,errors:r.formState.errors,description:s("Enable/disable the shadow picker.")})}),e.jsx(q,{label:s("Spacing"),value:e.jsxs("div",{className:"flex-column s-12",children:[e.jsx(re,{id:"supports.spacing.margin",register:r.register,errors:r.formState.errors,description:s("Enable/disable margin for arbitrary sides."),clearErrors:r.clearErrors,setValue:r.setValue,defaultValue:t[2]&&t[2].supports&&t[2].supports.spacing?t[2].supports.spacing.margin:[],values:[{label:s("Top"),value:"top"},{label:s("Right"),value:"right"},{label:s("Left"),value:"left"},{label:s("Bottom"),value:"bottom"}]}),e.jsx(re,{id:"supports.spacing.padding",register:r.register,errors:r.formState.errors,description:s("Enable/disable padding for all sides."),clearErrors:r.clearErrors,setValue:r.setValue,defaultValue:t[2]&&t[2].supports&&t[2].supports.spacing?t[2].supports.spacing.padding:[],values:[{label:s("Top"),value:"top"},{label:s("Right"),value:"right"},{label:s("Left"),value:"left"},{label:s("Bottom"),value:"bottom"}]}),e.jsx(re,{id:"supports.spacing.blockGap",register:r.register,errors:r.formState.errors,description:s("Enable/disable axial (column/row) block spacing controls."),clearErrors:r.clearErrors,setValue:r.setValue,defaultValue:t[2]&&t[2].supports&&t[2].supports.spacing?t[2].supports.spacing.blockGap:[],values:[{label:s("Vertical"),value:"vertical"},{label:s("Horizontal"),value:"horizontal"}]})]})}),e.jsx(q,{label:s("Typography"),value:e.jsxs("div",{className:"flex-column s-12",children:[e.jsx(A,{id:"supports.typography.fontSize",register:r.register,errors:r.formState.errors,description:s("Enable/disable support and UI control for font-size.")}),e.jsx(A,{id:"supports.typography.lineHeight",register:r.register,errors:r.formState.errors,description:s("Enable/disable support and UI control for font-size.")}),e.jsx(re,{id:"supports.typography.textAlign",register:r.register,errors:r.formState.errors,description:s("Declare support for specific text alignment options."),clearErrors:r.clearErrors,setValue:r.setValue,defaultValue:t[2]&&t[2].supports&&t[2].supports.typography?t[2].supports.typography.textAlign:[],values:[{label:s("Left"),value:"left"},{label:s("Center"),value:"center"},{label:s("Right"),value:"right"}]})]})})]})]})})})};us.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(L).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,edit:l.bool,loading:l.bool};const Nt=()=>{const n=Y(),{loading:a}=K(p=>p.saveBlock),{loading:g}=K(p=>p.fetchBlocks),{id:h}=ye(),{step:m}=ye(),[u,i]=k.useState(!1),[t,b]=k.useState(!1),[c,r]=k.useState(m?parseInt(m):0),[o,d]=k.useState({}),[x,f]=k.useState(h&&o[0]?s("Edit")+" "+o[0].title:s("Create new block")),R=bs();k.useEffect(()=>{h&&o[0]&&f(s("Edit")+" "+o[0].title),ke(x)},[o]),k.useEffect(()=>{h&&(i(!0),n(Fs({id:h})).then(p=>{p.payload.length!==1?b(!0):(d({1:{id:h,title:p.payload[0].title,name:p.payload[0].name,category:p.payload[0].category,icon:p.payload[0].icon,keywords:p.payload[0].keywords,postTypes:p.payload[0].postTypes},2:{supports:p.payload[0].supports},3:{controls:p.payload[0].controls},4:{callback:p.payload[0].callback},5:{css:p.payload[0].css}}),ke(s("Edit")+" "+p.payload[0].title),f(s("Edit")+" "+p.payload[0].title))}).catch(p=>{b(!0),console.error(p)}))},[]);const E=[{label:s("Dynamic blocks list"),link:"/blocks"},{label:x}],j=[{title:s("General"),description:s("General configuration")},{title:s("Supports"),description:s("Declare block support for certain features")},{title:s("Controls"),description:s("Add controls to the block")},{title:s("Callback"),description:s("Add the callback to the block")},{title:s("Style"),description:s("Add custom CSS to the block")}],C=(p,v)=>{o[v]=p,d(o),Hs(),Object.keys(o).length===5&&(h&&(o[1].id=h),n(Ms(o)).then(w=>{const y=w.payload;y.success?(zs("Block successfully saved."),R("/blocks"),$s()):Ce.error(y.error)}).catch(w=>{Ce.error(w)}))};return u&&g?e.jsx(Bs,{}):t?e.jsx(Ws,{}):e.jsx(z.Fragment,{children:e.jsx(fs,{steps:[e.jsx(Ze,{edit:u,title:x,headings:j,crumbs:E,stepActive:c,setStepActive:r,handleSubmit:C,formValues:o,setFormValues:d}),e.jsx(us,{edit:u,title:x,headings:j,crumbs:E,stepActive:c,setStepActive:r,handleSubmit:C,formValues:o,setFormValues:d}),e.jsx(is,{edit:u,title:x,headings:j,crumbs:E,stepActive:c,setStepActive:r,handleSubmit:C,formValues:o,setFormValues:d}),e.jsx(ds,{edit:u,title:x,headings:j,crumbs:E,stepActive:c,setStepActive:r,handleSubmit:C,formValues:o,setFormValues:d}),e.jsx(cs,{edit:u,title:x,headings:j,crumbs:E,stepActive:c,setStepActive:r,handleSubmit:C,formValues:o,setFormValues:d,loading:a})],activeStep:c})})};export{Nt as default};
