import{j as e,u as s}from"./fields-Uuj9pZLj.js";import{h as X,a as h,R as C,L as y,u as B}from"./vendor-D21mNUGX.js";import{s as b,n as f,D as I,a as w,f as U,L as G}from"./Layout-CbPpDR-w.js";import{P as x,u as P,B as R,s as p,cF as V,r as N,bY as H,I as K,p as W,w as D,aK as z,a as J,b as M,m as Q,c as Z,h as ee,L as se,q as E,A as te,t as oe}from"./index-DW87FRXD.js";import{B as ae}from"./index-DU1xUoYR.js";import{T as v}from"./index-D3iHHJgH.js";import{P as ne}from"./index-DfOJf81u.js";import{F as re,E as le}from"./FieldGroupsModal-BkHvLyRt.js";import{m as c}from"./metaTypes-Bb9tjSPe.js";import{E as ie}from"./index-n0xjyagi.js";import{M as ce}from"./index-mrXLwnSf.js";import{u as Y,a as de,b as ue,F as me}from"./index.esm-DCQn2FO4.js";import{u as he}from"./index-DRV1MUeg.js";import{B as xe}from"./index-C2f65238.js";import"./index-Cwt3Qm9G.js";import"./index-CTmKXGMM.js";import"./index-DbbBejw-.js";import"./index-kc5wfrYu.js";const L=({taxonomy:t,page:m,perPage:T})=>{const{reset:g}=Y(),r=P();X();const[n,a]=h.useState(!1),k=()=>{r(V(t)).then(u=>{const i=u.payload;i.success?(g(),a(!n),b("Taxonomy successfully deleted."),N()):f.error(i.error)}).catch(u=>{f.error(u)})},d=[e.jsx(R,{style:p.DANGER,onClick:()=>{k()},children:s("Yes, delete it")}),e.jsx(R,{style:p.SECONDARY,onClick:()=>{a(!n)},children:s("Return back to list")})];return e.jsxs(C.Fragment,{children:[e.jsx(ce,{title:s("Delete Taxonomy"),buttons:d,visible:n,children:e.jsx("div",{children:s("You are going to delete this taxonomy. Are you sure?")})}),e.jsx("a",{className:`color-${p.DANGER}`,href:"#",onClick:u=>{u.preventDefault(),a(!n)},children:s("Delete")})]})};L.propTypes={page:x.number.isRequired,perPage:x.number.isRequired,taxonomy:x.string.isRequired};const S=h.memo(({record:t,page:m,perPage:T})=>{const{register:g}=Y(),r=`elements.${t.slug}`,n=()=>{D("duplicateAction",{belongsTo:c.TAXONOMY,find:t.slug}).then(a=>{a.success===!0?(b("Taxonomy successfully duplicated."),w(),N()):f.error(a.error)}).catch(a=>{console.error(a),f.error(s("Unknown error, please retry later"))})};return e.jsx(C.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:!t.isNative&&e.jsxs("label",{className:"checkbox",htmlFor:r,"data-cy":`select-${t.slug}`,children:[e.jsx("input",{type:"checkbox",id:r,name:r,defaultChecked:!1,...g(r)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.slug}),e.jsx("td",{children:e.jsx(ie,{element:t})}),e.jsx("td",{children:H(t,"customPostTypes")&&t.customPostTypes.length>0?e.jsx(y,{to:`/assoc-post-taxonomy/${t.slug}`,children:s("Manage")}):e.jsx(y,{to:`/assoc-post-taxonomy/${t.slug}`,children:s("Associate")})}),e.jsx("td",{children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(y,{to:`/register_meta?belongsTo=${c.TAXONOMY}&find=${t.slug}`,children:s("Create")}),e.jsx(re,{find:t.slug,belongsTo:c.TAXONOMY})]})}),e.jsx("td",{children:!t.isNative&&e.jsx(I,{name:"block-menu",buttonClass:p.SECONDARY,anchor:e.jsx(K,{icon:"bx:dots-vertical-rounded",color:W(),width:24}),links:[e.jsx("a",{href:`#/view_taxonomy/${t.slug}`,children:s("View")}),e.jsx("a",{href:`#/edit_taxonomy/${t.slug}`,children:s("Edit")}),e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),n()},children:s("Duplicate")}),e.jsx(L,{page:m,perPage:T,taxonomy:t.slug}),e.jsx(le,{belongsTo:c.TAXONOMY,find:t.slug}),e.jsx(y,{to:`/permissions/taxonomy/${t.slug}/${t.id}`,className:"color-warning",children:s("Permissions")})]})})]})})});S.propTypes={page:x.number.isRequired,perPage:x.number.isRequired,record:x.object.isRequired};const pe=()=>{const t=document.globals,m=t.settings;z(c.TAXONOMY);const[T,g]=h.useReducer(o=>o+1,0);he();const r=h.useRef(),n=de({mode:"all"}),a=ue({control:n.control,name:"elements"}),k=P(),{data:d,loading:u}=J(o=>o.fetchTaxonomies),{page:i}=B(),A=m.length>0&&M(m,"key","records_per_page")!==""?M(m,"key","records_per_page").value:20,O=Math.ceil(d.count/A);h.useEffect(()=>{Q(s("Registered Taxonomies")),Z("#/taxonomies"),k(ee({page:i||1,perPage:A})).then(o=>{U()})},[i]),h.useEffect(()=>{(()=>{if(!a)return!1;let l=0;for(const[j,q]of Object.entries(a))q===!0&&l++;return l===Object.entries(a).length})()?r.current.checked=!0:r.current&&(r.current.checked=!1)},[a]),document.addEventListener("restoredElement",function(){g()});const $=o=>{n.reset(),o.belongsTo=c.TAXONOMY;const l=o.action;if(l)switch(l){case"hide":oe(o);break;case"delete":case"duplicate":D("bulkActionsAction",o).then(j=>{if(j.success===!0){switch(o.action){case"delete":b("Taxonomy successfully deleted.");break;case"duplicate":b("Taxonomy successfully duplicated.");break}w(),N()}else f.error(j.error)}).catch(j=>{console.error(j),f.error(s("Unknown error, please retry later"))});break}},F=o=>{d.records.filter(l=>l.isNative===!1).filter(l=>!E(l.slug,c.TAXONOMY)).map(l=>{n.setValue(`elements.${l.slug}`,o)})},_=[e.jsx(ae,{style:p.PRIMARY,to:"/register_taxonomy",children:s("Register new Taxonomy")})];return u?e.jsx(se,{}):e.jsx(me,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit($),children:e.jsxs(G,{title:s("Registered Taxonomies"),actions:_,crumbs:[{label:s("Registered Taxonomies")}],children:[e.jsx(xe,{belongsTo:c.TAXONOMY}),d.records&&d.records.length>0?e.jsx("div",{className:"responsive with-shadow b-rounded",children:e.jsxs("table",{"data-cy":"cpt-table",className:`acpt-table rounded ${t.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":"select-all",className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:r,type:"checkbox",id:"all",defaultChecked:!1,onClick:o=>F(o.currentTarget.checked)}),e.jsx("span",{})]})}),e.jsx("th",{children:e.jsx(v,{tip:s("Taxonomy slug. The post name/slug. Used for various queries for taxonomy content."),label:s("Slug")})}),e.jsx("th",{children:s("Type")}),e.jsx("th",{children:e.jsx(v,{tip:s("Associate custom post types here"),label:s("Associated post types")})}),e.jsx("th",{children:s("Field groups")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:d.records&&d.records.map(o=>{if(!E(o.slug,c.TAXONOMY))return e.jsx(S,{record:o,page:i,perPage:A},o.id)})}),O>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:e.jsx(ne,{currentPage:i?parseInt(i):1,totalPages:O,baseLink:"/taxonomies"})})})})]})}):e.jsxs(te,{style:p.SECONDARY,children:[s("No taxonomies found.")," ",e.jsx(y,{to:"/register_taxonomy",children:s("Register the first one")}),"!"]})]})})})};pe.propTypes={};export{pe as default};
