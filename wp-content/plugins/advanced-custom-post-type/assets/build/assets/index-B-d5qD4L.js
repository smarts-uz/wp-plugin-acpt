import{j as r,u as t,s as G}from"./fields-Uuj9pZLj.js";import{a as y,R as W,u as N,h as H}from"./vendor-D21mNUGX.js";import{P as l,B as R,a as V,s as T,u as Q,h as Z,m as O,c as z,L as J,cD as K,r as X}from"./index-DW87FRXD.js";import{P as ee}from"./index-DHZeBRHg.js";import{L as k,a as te,s as se,n as F}from"./Layout-CbPpDR-w.js";import{S as $,a as re}from"./StepsHeader-E13EP3oN.js";import{u as ae,a as P,F as A}from"./index.esm-DCQn2FO4.js";import{C as D}from"./index-Dp7DyYVn.js";import{I as q}from"./Input-Dag95jow.js";import{C as n}from"./CardRow-D0wbqPA3.js";import{c as ie,d as le}from"./validation-dtG0NF0D.js";import{t as ne}from"./taxonomyLabels-BfBBOfTw.js";import{T as g}from"./Toggle-C4UaD4f5.js";import{C as oe}from"./Checkbox-BnNcyaPE.js";const C=({stepActive:w,setStepActive:S,setFormValues:b=null,steps:u})=>{const{getValues:c}=ae();let p=[];for(const[s,o]of Object.entries(u))p.push(r.jsx("li",{className:`acpt-accordion-tab ${parseInt(s)===parseInt(w)?"active":""}`,onClick:()=>{b&&b(m=>(m[parseInt(w)+1]=c(),m)),S(s)},children:r.jsx("span",{children:o.title})},s));return r.jsx("div",{className:"acpt-tabs mb-12",children:r.jsx("ul",{role:"tablist",className:"tablist mb-12",children:p&&p.map(s=>s)})})};C.propTypes={setFormValues:l.func,setStepActive:l.func.isRequired,stepActive:l.number.isRequired,steps:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired};const M=({title:w,crumbs:S,headings:b,stepActive:u,setStepActive:c,handleSubmit:p,formValues:s,edit:o=!1,setFormValues:m=null})=>{const{data:d}=V(_=>_.fetchTaxonomies),a=P({mode:"onChange"});y.useEffect(()=>{d.length>0&&(a.setValue("slug",d[0].slug),a.setValue("singular_label",d[0].singular),a.setValue("plural_label",d[0].plural))},[d]),y.useEffect(()=>{s&&s[1]&&(a.setValue("slug",s[1].slug),a.setValue("singular_label",s[1].singular_label),a.setValue("plural_label",s[1].plural_label))},[s]);const e=_=>{a.setValue("slug",G(_,32))},i=_=>{s[1]&&m(j=>{const v={...j};return v[1].singular_label=_,v})},x=_=>{p(_,1),o||c(1)},f=[r.jsx(R,{testId:"next-step",style:o?T.PRIMARY:T.SECONDARY,children:t(o?"Save":"Next Step")})];return r.jsx(A,{...a,children:r.jsx("form",{onSubmit:a.handleSubmit(x),children:r.jsxs(k,{crumbs:S,title:w,actions:f,children:[o&&r.jsx(C,{setFormValues:m,stepActive:u,setStepActive:c,steps:b}),r.jsxs(D,{style:"with-shadow",children:[!o&&r.jsx($,{stepActive:u,headings:b}),r.jsx(n,{label:t("Slug"),value:r.jsx(q,{id:"slug",placeholder:t("Slug"),readOnly:d.length>0,description:t("The post name/slug. Used for various queries for taxonomy content."),onChangeCapture:_=>e(_.currentTarget.value),register:a.register,errors:a.formState.errors,isRequired:!0,validate:{validate:o?ie:le,required:t("This field is mandatory")}})}),r.jsx(n,{label:t("Singular label"),value:r.jsx(q,{id:"singular_label",placeholder:t("(e.g. Movie)"),description:t("Used when a singular label is needed"),register:a.register,errors:a.formState.errors,isRequired:!0,onChangeCapture:_=>i(_.currentTarget.value),validate:{required:t("This field is mandatory")}})}),r.jsx(n,{label:t("Plural label"),value:r.jsx(q,{id:"plural_label",placeholder:t("(e.g. Movies)"),description:t("Used for the taxonomy admin menu item"),register:a.register,errors:a.formState.errors,isRequired:!0,validate:{required:t("This field is mandatory")}})})]})]})})})};M.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(R).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,edit:l.bool};const U=({title:w,crumbs:S,headings:b,stepActive:u,setStepActive:c,handleSubmit:p,formValues:s,edit:o,setFormValues:m=null})=>{const{data:d}=V(f=>f.fetchTaxonomies);let a={};d.length>0&&(a=d[0].labels);const e=P({mode:"onChange"});y.useEffect(()=>{o&&d.length>0&&(e.setValue("name",a.name),e.setValue("singular_name",a.singular_name),e.setValue("search_items",a.search_items),e.setValue("popular_items",a.popular_items),e.setValue("all_items",a.all_items),e.setValue("parent_item",a.parent_item),e.setValue("parent_item_colon",a.parent_item_colon),e.setValue("edit_item",a.edit_item),e.setValue("view_item",a.view_item),e.setValue("update_item",a.update_item),e.setValue("add_new_item",a.add_new_item),e.setValue("new_item_name",a.new_item_name),e.setValue("separate_items_with_commas",a.separate_items_with_commas),e.setValue("add_or_remove_items",a.add_or_remove_items),e.setValue("choose_from_most_used",a.choose_from_most_used),e.setValue("not_found",a.not_found),e.setValue("no_terms",a.no_terms),e.setValue("filter_by_item",a.filter_by_item),e.setValue("items_list_navigation",a.items_list_navigation),e.setValue("items_list",a.items_list),e.setValue("most_used",a.most_used),e.setValue("back_to_items",a.back_to_items))},[]),y.useEffect(()=>{o?s&&s[2]&&(e.setValue("name",s[2].name),e.setValue("singular_name",s[2].singular_name),e.setValue("search_items",s[2].search_items),e.setValue("popular_items",s[2].popular_items),e.setValue("all_items",s[2].all_items),e.setValue("parent_item",s[2].parent_item),e.setValue("parent_item_colon",s[2].parent_item_colon),e.setValue("edit_item",s[2].edit_item),e.setValue("view_item",s[2].view_item),e.setValue("update_item",s[2].update_item),e.setValue("add_new_item",s[2].add_new_item),e.setValue("new_item_name",s[2].new_item_name),e.setValue("separate_items_with_commas",s[2].separate_items_with_commas),e.setValue("add_or_remove_items",s[2].add_or_remove_items),e.setValue("choose_from_most_used",s[2].choose_from_most_used),e.setValue("not_found",s[2].not_found),e.setValue("no_terms",s[2].no_terms),e.setValue("filter_by_item",s[2].filter_by_item),e.setValue("items_list_navigation",s[2].items_list_navigation),e.setValue("items_list",s[2].items_list),e.setValue("most_used",s[2].most_used),e.setValue("back_to_items",s[2].back_to_items)):s&&s[1]&&(e.setValue("name",s[1].plural_label),e.setValue("singular_name",s[1].singular_label),e.setValue("search_items",`${t("Search {{r}}",{r:s[1].plural_label})}`),e.setValue("popular_items",`${t("Popular {{r}}",{r:s[1].plural_label})}`),e.setValue("all_items",`${t("All {{r}}",{r:s[1].plural_label})}`),e.setValue("parent_item",`${t("Parent {{r}}",{r:s[1].singular_label})}`),e.setValue("parent_item_colon",t("Parent item")),e.setValue("edit_item",`${t("Edit")}`),e.setValue("view_item",`${t("View")}`),e.setValue("update_item",`${t("Update {{r}}",{r:s[1].singular_label})}`),e.setValue("add_new_item",`${t("Add new {{r}}",{r:s[1].singular_label})}`),e.setValue("new_item_name",`${t("New {{r}}",{r:s[1].singular_label})}`),e.setValue("separate_items_with_commas",`${t("Separate {{r}} with commas",{r:s[1].plural_label})}`),e.setValue("add_or_remove_items",`${t("Add or remove {{r}}",{r:s[1].plural_label})}`),e.setValue("choose_from_most_used",`${t("Choose from most used {{r}}",{r:s[1].singular_label})}`),e.setValue("not_found",t("No {{r}} found",{r:s[1].singular_label})),e.setValue("no_terms",`${t("No {{r}}",{r:s[1].plural_label})}`),e.setValue("filter_by_item",`${t("Filter by {{r}}",{r:s[1].singular_label})}`),e.setValue("items_list_navigation",t("Navigation list {{r}}",{r:s[1].plural_label})),e.setValue("items_list",t("List {{r}}",{r:s[1].plural_label})),e.setValue("most_used",`${t("Most used {{r}}",{r:s[1].plural_label})}`),e.setValue("back_to_items",`${t("Back to {{r}}",{r:s[1].plural_label})}`))},[s]);const i=f=>{p(f,2),o||c(2)};let x=[];return o||x.push(r.jsx(R,{testId:"prev-step",type:"button",onClick:()=>c(0),style:T.SECONDARY,children:t("Previous Step")})),x.push(r.jsx(R,{testId:"next-step",style:o?T.PRIMARY:T.SECONDARY,children:t(o?"Save":"Next Step")})),r.jsx(A,{...e,children:r.jsx("form",{onSubmit:e.handleSubmit(i),children:r.jsxs(k,{crumbs:S,title:w,actions:x,children:[o&&r.jsx(C,{setFormValues:m,stepActive:u,setStepActive:c,steps:b}),r.jsxs(D,{style:"with-shadow",children:[!o&&r.jsx($,{stepActive:u,headings:b}),ne.map(f=>r.jsx(n,{label:f.label,value:r.jsx(q,{id:f.id,register:e.register,description:f.description,errors:e.formState.errors,isRequired:!0,validate:{required:t("This field is mandatory")}})}))]})]})})})};U.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(R).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,edit:l.bool.isRequired};const B=({title:w,crumbs:S,headings:b,stepActive:u,setStepActive:c,handleSubmit:p,formValues:s,loading:o=!1,edit:m=!1,setFormValues:d=null})=>{const{data:a}=V(v=>v.fetchTaxonomies);let e={};a.length>0&&(e=a[0].settings);const i=P({mode:"all",defaultValues:{public:a.length>0?e.public:null,publicly_queryable:a.length>0?e.publicly_queryable:null,hierarchical:a.length>0?e.hierarchical:null,show_ui:a.length>0?e.show_ui:null,show_in_menu:a.length>0?e.show_in_menu:null,show_in_nav_menus:a.length>0?e.show_in_nav_menus:null,show_in_rest:a.length>0?e.show_in_rest:null,rest_base:a.length>0?e.rest_base:null,rest_controller_class:a.length>0?e.rest_controller_class:null,show_tagcloud:a.length>0?e.show_tagcloud:null,show_in_quick_edit:a.length>0?e.show_in_quick_edit:null,show_admin_column:a.length>0?e.show_admin_column:null,capabilities:a.length>0?e.capabilities:null,rewrite:a.length>0?e.rewrite:null,custom_rewrite:a.length>0?e.custom_rewrite:null,query_var:a.length>0?e.query_var:null,custom_query_var:a.length>0?e.custom_query_var:null,default_term:a.length>0?e.default_term:null,sort:a.length>0?e.sort:null}});y.useEffect(()=>{m&&s&&s[3]&&(i.setValue("public",s[3].public),i.setValue("publicly_queryable",s[3].publicly_queryable),i.setValue("hierarchical",s[3].hierarchical),i.setValue("show_ui",s[3].show_ui),i.setValue("show_in_menu",s[3].show_in_menu),i.setValue("show_in_nav_menus",s[3].show_in_nav_menus),i.setValue("show_in_rest",s[3].show_in_rest),i.setValue("rest_base",s[3].rest_base),i.setValue("rest_controller_class",s[3].rest_controller_class),i.setValue("show_tagcloud",s[3].show_tagcloud),i.setValue("show_in_quick_edit",s[3].show_in_quick_edit),i.setValue("show_admin_column",s[3].show_admin_column),i.setValue("capabilities",s[3].capabilities),i.setValue("rewrite",s[3].rewrite),i.setValue("custom_rewrite",s[3].custom_rewrite),i.setValue("query_var",s[3].query_var),i.setValue("custom_query_var",s[3].custom_query_var),i.setValue("default_term",s[3].default_term),i.setValue("sort",s[3].sort))},[s]);const x=i.watch("rewrite"),f=i.watch("query_var"),_=v=>{p(v,3)};let j=[];return m||j.push(r.jsx(R,{testId:"prev-step",type:"button",onClick:()=>c(1),style:T.SECONDARY,children:t("Previous Step")})),j.push(r.jsx(R,{testId:"next-step",style:T.PRIMARY,children:t("Save")})),r.jsx(A,{...i,children:r.jsx("form",{onSubmit:i.handleSubmit(_),children:r.jsxs(k,{crumbs:S,title:w,actions:j,children:[m&&r.jsx(C,{setFormValues:d,stepActive:u,setStepActive:c,steps:b}),r.jsxs(D,{style:"with-shadow",children:[!m&&r.jsx($,{setStepActive:c,stepActive:u,headings:b}),r.jsx(n,{label:t("Is Public"),value:r.jsx(g,{id:"public",description:t("Whether a taxonomy is intended for use publicly either via the admin interface or by front-end users."),defaultValue:a.length>0?e.public:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Publicly queryable"),value:r.jsx(g,{id:"publicly_queryable",description:t("Whether the taxonomy is publicly queryable. If not set, the default is inherited from $public."),defaultValue:a.length>0?e.publicly_queryable:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Hierarchical"),value:r.jsx(g,{id:"hierarchical",description:t("Whether the taxonomy is hierarchical. Default false."),defaultValue:a.length>0?e.hierarchical:!1,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Show in UI"),value:r.jsx(g,{id:"show_ui",description:t("Whether to generate and allow a UI for managing terms in this taxonomy in the admin. If not set, the default is inherited from $public (default true)."),defaultValue:a.length>0?e.show_ui:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Show in menu"),value:r.jsx(g,{id:"show_in_menu",description:t("Whether to show the taxonomy in the admin menu. If true, the taxonomy is shown as a submenu of the object type menu. If false, no menu is shown. $show_ui must be true. If not set, default is inherited from $show_ui (default true)."),defaultValue:a.length>0?e.show_in_menu:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Show in nav menus"),value:r.jsx(g,{id:"show_in_nav_menus",description:t("Makes this taxonomy available for selection in navigation menus. If not set, the default is inherited from $public (default true)."),defaultValue:a.length>0?e.show_in_nav_menus:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Show in REST API"),value:r.jsx(g,{id:"show_in_rest",description:t("Whether to include the taxonomy in the REST API. Set this to true for the taxonomy to be available in the block editor. SET TRUE TO ENABLE VISUALIZATION ON GUTEMBERG EDITOR."),defaultValue:a.length>0?e.show_in_rest:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("REST API base slug"),value:r.jsx(q,{id:"rest_base",placeholder:t("REST API base slug"),description:t("To change the base url of REST API route. Default is $taxonomy."),validate:{maxLength:{value:255,message:"max length is 255"}},register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("REST controller class"),value:r.jsx(q,{id:"rest_controller_class",placeholder:t("REST controller class"),description:t("REST API Controller class name. Default is 'WP_REST_Terms_Controller'."),validate:{maxLength:{value:255,message:"max length is 255"}},register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Show Tagcloud"),value:r.jsx(g,{id:"show_tagcloud",description:t("Whether to list the taxonomy in the Tag Cloud Widget controls. If not set, the default is inherited from $show_ui (default true)."),defaultValue:a.length>0?e.show_tagcloud:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Show in quick edit"),value:r.jsx(g,{id:"show_in_quick_edit",description:t("Whether to show the taxonomy in the quick/bulk edit panel. It not set, the default is inherited from $show_ui (default true)."),defaultValue:a.length>0?e.show_in_quick_edit:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Show admin column"),value:r.jsx(g,{id:"show_admin_column",description:t("Whether to display a column for the taxonomy on its post type listing screens. Default false."),defaultValue:a.length>0?e.show_admin_column:!1,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Capabilities"),value:r.jsx(oe,{id:"capabilities",defaultValue:"post",description:t("Array of capabilities for this taxonomy."),register:i.register,errors:i.formState.errors,values:{manage_terms:{value:"manage_terms",checked:a.length>0&&e.capabilities?e.capabilities.includes("manage_terms"):!0},edit_terms:{value:"edit_terms",checked:a.length>0&&e.capabilities?e.capabilities.includes("edit_terms"):!0},delete_terms:{value:"delete_terms",checked:a.length>0&&e.capabilities?e.capabilities.includes("delete_terms"):!0},assign_terms:{value:"assign_terms",checked:a.length>0&&e.capabilities?e.capabilities.includes("assign_terms"):!0}},validate:{maxLength:{value:255,message:t("max length is 255")}}})}),r.jsx(n,{label:t("Rewrite"),value:r.jsx(g,{id:"rewrite",description:t("Triggers the handling of rewrites for this taxonomy. Default true, using $taxonomy as slug. To prevent rewrite, set to false. To specify rewrite rules, an array can be passed with any of these keys:"),defaultValue:a.length>0?e.rewrite:!1,register:i.register,errors:i.formState.errors})}),x&&r.jsxs(W.Fragment,{children:[r.jsx(n,{label:t("Custom rewrite rules"),value:r.jsx(q,{id:"custom_rewrite",placeholder:t("Custom rewrite rules"),description:t("Taxonomy slug to use instead of default."),validate:{maxLength:{value:255,message:"max length is 255"}},register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("With front"),value:r.jsx(g,{id:"with_front",description:t("Should the permastruct be prepended with WP_Rewrite::$front. Default true."),defaultValue:a.length>0&&typeof e.with_front<"u"?e.with_front:!0,register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Rewrite hierarchical"),value:r.jsx(g,{id:"rewrite_hierarchical",description:t("Either hierarchical rewrite tag or not. Default false."),defaultValue:a.length>0&&typeof e.rewrite_hierarchical<"u"?e.rewrite_hierarchical:!1,register:i.register,errors:i.formState.errors})})]}),r.jsx(n,{label:t("Query var"),value:r.jsx(g,{id:"query_var",description:t("Sets the query var key for this taxonomy. Default $taxonomy key. If false, a taxonomy cannot be loaded at ?{query_var}={term_slug}. If a string, the query ?{query_var}={term_slug} will be valid."),defaultValue:a.length>0?e.query_var:!1,register:i.register,errors:i.formState.errors})}),f&&r.jsx(n,{label:t("Custom query var"),value:r.jsx(q,{id:"custom_query_var",placeholder:t("Custom query var"),description:t("Custom query var slug to use instead of default."),validate:{maxLength:{value:255,message:"max length is 255"}},register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Default term"),value:r.jsx(q,{id:"default_term",placeholder:t("Default term to be used for the taxonomy."),description:t("Allowed keys: 'name', name of default term.|'slug', Slug for default term.|'description', Description for default term"),validate:{maxLength:{value:255,message:"max length is 255"}},register:i.register,errors:i.formState.errors})}),r.jsx(n,{label:t("Sort"),value:r.jsx(g,{id:"sort",description:t("Whether terms in this taxonomy should be sorted in the order they are provided to wp_set_object_terms(). Default null which equates to false."),defaultValue:a.length>0?e.sort:!1,register:i.register,errors:i.formState.errors})})]})]})})})};B.propTypes={headings:l.arrayOf(l.shape({label:l.string.isRequired,description:l.string.isRequired})).isRequired,title:l.string.isRequired,crumbs:l.arrayOf(R).isRequired,stepActive:l.number.isRequired,setStepActive:l.func.isRequired,handleSubmit:l.func.isRequired,formValues:l.object.isRequired,setFormValues:l.func,loading:l.bool,edit:l.bool};const je=({})=>{const w=Q(),{loading:S}=V(h=>h.saveTaxonomy),{loading:b}=V(h=>h.fetchTaxonomies),{taxonomy:u}=N(),{step:c}=N(),[p,s]=y.useState(!1),[o,m]=y.useState(!1),[d,a]=y.useState(c?parseInt(c):0),[e,i]=y.useState({}),[x,f]=y.useState(u&&e[1]?t("Edit")+" "+e[1].singular_label:t("Create new Taxonomy")),_=H();(u==="category"||u==="product_tag")&&_("/"),y.useEffect(()=>{u&&e[1]&&f(t("Edit")+" "+e[1].singular_label)},[e]),y.useEffect(()=>{u?(w(Z({taxonomy:u})).then(h=>{h.payload.length!==1?m(!0):(i({1:{slug:h.payload[0].slug,plural_label:h.payload[0].plural,singular_label:h.payload[0].singular},2:h.payload[0].labels,3:h.payload[0].settings}),O(`${t("Edit")} ${h.payload[0].singular}`))}).catch(h=>{m(!0),console.error(h)}),s(!0)):(O(t("Create new Taxonomy")),z("#/register_taxonomy"))},[]);const j=[{label:t("Registered Taxonomies"),link:"/taxonomies"},{label:x}],v=[{title:t("Basic"),description:t("Minimum configuration")},{title:t("Labels"),description:t("Additional labels")},{title:t("Settings"),description:t("Other settings")}],I=(h,Y)=>{e[Y]=h,i(e),te(),Object.keys(e).length===3&&w(K(e)).then(E=>{const L=E.payload;L.success?(se("Taxonomy successfully saved."),_("/taxonomies"),X()):F.error(L.error)}).catch(E=>{F.error(E)})};return p&&b?r.jsx(J,{}):o?r.jsx(ee,{}):r.jsx(W.Fragment,{children:r.jsx(re,{steps:[r.jsx(M,{edit:p,title:x,headings:v,crumbs:j,stepActive:d,setStepActive:a,handleSubmit:I,formValues:e,setFormValues:i}),r.jsx(U,{edit:p,title:x,headings:v,crumbs:j,stepActive:d,setStepActive:a,handleSubmit:I,formValues:e,setFormValues:i}),r.jsx(B,{title:x,headings:v,crumbs:j,stepActive:d,setStepActive:a,handleSubmit:I,formValues:e,setFormValues:i,loading:S,edit:p})],activeStep:d})})};export{je as default};
